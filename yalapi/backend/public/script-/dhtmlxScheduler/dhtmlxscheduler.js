function dataProcessor(a){this.serverProcessor=a;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=true;this.updateMode="cell";this._tMode="GET";this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",clear:"font-weight:normal;text-decoration:none;"};
this.enableUTFencoding(true);dhtmlxEventable(this);return this}function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,false):a.attachEvent&&a.attachEvent("on"+b,c)}function dhtmlXHeir(a,b){for(var c in b)typeof b[c]=="function"&&(a[c]=b[c]);return a}function z(){if(!this.catches)this.catches=[];return this}
function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)return window.dhtmlDragAndDrop;this.dragStartObject=this.dragStartNode=this.dragNode=this.lastLanding=0;this.tempDOMM=this.tempDOMU=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this}function getUrlSymbol(a){return a.indexOf("?")!=-1?"&":"?"}function convertStringToBoolean(a){typeof a=="string"&&(a=a.toLowerCase());switch(a){case "1":case "true":case "yes":case "y":case 1:case true:return true;default:return false}}
function getOffset(a){return a.getBoundingClientRect&&!_isChrome?getOffsetRect(a):getOffsetSum(a)}function getOffsetRect(a){var a=a.getBoundingClientRect(),b=document.body,c=document.documentElement,d=a.left+(window.pageXOffset||c.scrollLeft||b.scrollLeft)-(c.clientLeft||b.clientLeft||0);return{top:Math.round(a.top+(window.pageYOffset||c.scrollTop||b.scrollTop)-(c.clientTop||b.clientTop||0)),left:Math.round(d)}}
function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function getAbsoluteTop(a){return getOffset(a).top}function getAbsoluteLeft(a){return getOffset(a).left}function callerFunction(a,b){return this.handler=function(c){if(!c)c=window.event;a(c,b);return true}}
function dtmlXMLLoaderObject(a,b,c,d){this.xmlDoc="";this.async=typeof c!="undefined"?c:true;this.onloadAction=a||null;this.mainObject=b||null;this.waitCall=null;this.rSeed=d||false;return this}dhtmlx=function(a){for(var b in a)dhtmlx[b]=a[b];return dhtmlx};
dhtmlx.extend_api=function(a,b,c){var d=window[a];if(d)window[a]=function(a){if(a&&typeof a=="object"&&!a.tagName&&!(a instanceof Array)){var c=d.apply(this,b._init?b._init(a):arguments),g;for(g in dhtmlx)if(b[g])this[b[g]](dhtmlx[g]);for(g in a)if(b[g])this[b[g]](a[g]);else g.indexOf("on")==0&&this.attachEvent(g,a[g])}else c=d.apply(this,arguments);b._patch&&b._patch(this);return c||this},window[a].prototype=d.prototype,c&&dhtmlXHeir(window[a].prototype,c)};
dhtmlxAjax={get:function(a,b){var c=new dtmlXMLLoaderObject(true);c.async=arguments.length<3;c.waitCall=b;c.loadXML(a);return c},post:function(a,b,c){var d=new dtmlXMLLoaderObject(true);d.async=arguments.length<4;d.waitCall=c;d.loadXML(a,true,b);return d},getSync:function(a){return this.get(a,null,true)},postSync:function(a,b){return this.post(a,b,null,true)}};
dtmlXMLLoaderObject.prototype.waitLoadFunction=function(a){var b=true;return this.check=function(){if(a&&a.onloadAction!=null&&(!a.xmlDoc.readyState||a.xmlDoc.readyState==4)&&b){b=false;if(typeof a.onloadAction=="function")a.onloadAction(a.mainObject,null,null,null,a);if(a.waitCall)a.waitCall.call(this,a),a.waitCall=null}}};
dtmlXMLLoaderObject.prototype.getXMLTopNode=function(a,b){if(this.xmlDoc.responseXML){var c=this.xmlDoc.responseXML.getElementsByTagName(a);c.length==0&&a.indexOf(":")!=-1&&(c=this.xmlDoc.responseXML.getElementsByTagName(a.split(":")[1]));c=c[0]}else c=this.xmlDoc.documentElement;if(c)return this._retry=false,c;if(_isIE&&!this._retry)return c=this.xmlDoc.responseText,b=this.xmlDoc,this._retry=true,this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=false,this.xmlDoc.loadXML(c),this.getXMLTopNode(a,
b);dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]);return document.createElement("DIV")};dtmlXMLLoaderObject.prototype.loadXMLString=function(a){try{this.xmlDoc=(new DOMParser).parseFromString(a,"text/xml")}catch(b){this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.loadXML(a)}this.onloadAction(this.mainObject,null,null,null,this);if(this.waitCall)this.waitCall(),this.waitCall=null};
dtmlXMLLoaderObject.prototype.loadXML=function(a,b,c,d){this.rSeed&&(a+=(a.indexOf("?")!=-1?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf());this.filePath=a;this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(this.async)this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this);this.xmlDoc.open(b?"POST":"GET",a,this.async);d?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type",
"text/xml")):b&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(c);this.async||(new this.waitLoadFunction(this))()};dtmlXMLLoaderObject.prototype.destructor=function(){return this.xmlDoc=this.mainObject=this.onloadAction=null};
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;b._tagvalue=a.firstChild?a.firstChild.nodeValue:"";for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c].tagName;d&&(b[d]||(b[d]=[]),b[d].push(this.xmlNodeToJSON(a.childNodes[c])))}return b};dhtmlDragAndDropObject.prototype.removeDraggableItem=function(a){a.onmousedown=null;a.dragStarter=null;a.dragLanding=null};
dhtmlDragAndDropObject.prototype.addDraggableItem=function(a,b){a.onmousedown=this.preCreateDragCopy;a.dragStarter=b;this.addDragLanding(a,b)};dhtmlDragAndDropObject.prototype.addDragLanding=function(a,b){a.dragLanding=b};
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(a){if(!((a||event)&&(a||event).button==2)){if(window.dhtmlDragAndDrop.waitDrag)return window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,false;window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=
this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=(new Date).valueOf();a&&a.preventDefault&&a.preventDefault();return false}};
dhtmlDragAndDropObject.prototype.callDrag=function(a){if(!a)a=window.event;dragger=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-dragger.downtime<100)){if(a.button==0&&_isIE)return dragger.stopDrag();if(!dragger.dragNode&&dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,a);if(!dragger.dragNode)return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return false};dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);
document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=0;dragger.dragNode.pWindow=window;dragger.initFrameRoute()}if(dragger.dragNode.parentNode!=window.document.body){var b=dragger.gldragNode;if(dragger.gldragNode.old)b=dragger.gldragNode.old;b.parentNode.removeChild(b);b=dragger.dragNode.pWindow;if(_isIE){var c=document.createElement("Div");c.innerHTML=dragger.dragNode.outerHTML;dragger.dragNode=c.childNodes[0]}else dragger.dragNode=dragger.dragNode.cloneNode(true);dragger.dragNode.pWindow=window;
dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);b.dhtmlDragAndDrop.dragNode=dragger.dragNode}dragger.dragNode.style.left=a.clientX+15+(dragger.fx?dragger.fx*-1:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=a.clientY+3+(dragger.fy?dragger.fy*-1:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";dragger.checkLanding(a.srcElement?a.srcElement:a.target,a)}};
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(a){if(window.name){for(var b=parent.frames[window.name].frameElement.offsetParent,c=0,d=0;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;parent.dhtmlDragAndDrop&&(b=parent.dhtmlDragAndDrop.calculateFramePosition(1),c+=b.split("_")[0]*1,d+=b.split("_")[1]*1);if(a)return c+"_"+d;else this.fx=c;this.fy=d}return"0_0"};
dhtmlDragAndDropObject.prototype.checkLanding=function(a,b){a&&a.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=a,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,b.clientX,b.clientY,b),this.lastLanding_scr=_isIE?b.srcElement:b.target):a&&a.tagName!="BODY"?this.checkLanding(a.parentNode,b):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,b.clientX,b.clientY,b),this.lastLanding=
0,this._onNotFound&&this._onNotFound())};
dhtmlDragAndDropObject.prototype.stopDrag=function(a,b){dragger=window.dhtmlDragAndDrop;if(!b){dragger.stopFrameRoute();var c=dragger.lastLanding;dragger.lastLanding=null;c&&c.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,c,_isIE?event.srcElement:a.target)}dragger.lastLanding=null;dragger.dragNode&&dragger.dragNode.parentNode==document.body&&dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=
0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0};dhtmlDragAndDropObject.prototype.stopFrameRoute=function(a){a&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var b=0;b<window.frames.length;b++)try{window.frames[b]!=a&&window.frames[b].dhtmlDragAndDrop&&window.frames[b].dhtmlDragAndDrop.stopFrameRoute(window)}catch(c){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(d){}};
dhtmlDragAndDropObject.prototype.initFrameRoute=function(a,b){if(a)window.dhtmlDragAndDrop.preCreateDragCopy({}),window.dhtmlDragAndDrop.dragStartNode=a.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=a.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=a.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=a.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&b&&(!_isFF||w<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition();
try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(c){}for(var d=0;d<window.frames.length;d++)try{window.frames[d]!=a&&window.frames[d].dhtmlDragAndDrop&&window.frames[d].dhtmlDragAndDrop.initFrameRoute(window,!a||b?1:0)}catch(e){}};w=_OperaRv=x=_isChrome=_isMacOS=_isKHTML=_isOpera=_isIE=_isFF=false;navigator.userAgent.indexOf("Macintosh")!=-1&&(_isMacOS=true);navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=true);
if(navigator.userAgent.indexOf("Safari")!=-1||navigator.userAgent.indexOf("Konqueror")!=-1){var x=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5));if(x>525){_isFF=true;var w=1.9}else _isKHTML=true}else navigator.userAgent.indexOf("Opera")!=-1?(_isOpera=true,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):navigator.appName.indexOf("Microsoft")!=-1?(_isIE=true,navigator.appVersion.indexOf("MSIE 8.0")!=-1&&document.compatMode!=
"BackCompat"&&(_isIE=8)):(_isFF=true,w=parseFloat(navigator.userAgent.split("rv:")[1]));
dtmlXMLLoaderObject.prototype.doXPath=function(a,b,c,d){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(a,b);if(_isIE)return b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),c!=null&&b.setProperty("SelectionNamespaces","xmlns:xsl='"+c+"'"),d=="single"?b.selectSingleNode(a):b.selectNodes(a)||[];else{var e=b;b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML);b||dhtmlxError.throwError("LoadXML",
"Incorrect XML",[b||this.xmlDoc,this.mainObject]);b.nodeName.indexOf("document")!=-1?e=b:(e=b,b=b.ownerDocument);var f=XPathResult.ANY_TYPE;if(d=="single")f=XPathResult.FIRST_ORDERED_NODE_TYPE;d=[];a=b.evaluate(a,e,function(){return c},f,null);if(f==XPathResult.FIRST_ORDERED_NODE_TYPE)return a.singleNodeValue;for(f=a.iterateNext();f;)d[d.length]=f,f=a.iterateNext();return d}};z.prototype.catchError=function(a,b){this.catches[a]=b};
z.prototype.throwError=function(a,b,c){if(this.catches[a])return this.catches[a](a,b,c);if(this.catches.ALL)return this.catches.ALL(a,b,c);alert("Error type: "+a+"\nDescription: "+b);return null};window.dhtmlxError=new z;
dtmlXMLLoaderObject.prototype.doXPathOpera=function(a,b){var c=a.replace(/[\/]+/gi,"/").split("/"),d=null,e=1;if(!c.length)return[];if(c[0]==".")d=[b];else if(c[0]=="")d=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(c[e].replace(/\[[^\]]*\]/g,"")),e++;else return[];for(;e<c.length;e++)d=this._getAllNamedChilds(d,c[e]);c[e-1].indexOf("[")!=-1&&(d=this._filterXPath(d,c[e-1]));return d};
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){for(var c=[],b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),d=0;d<a.length;d++)a[d].getAttribute(b)&&(c[c.length]=a[d]);return c};
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=[];_isKHTML&&(b=b.toUpperCase());for(var d=0;d<a.length;d++)for(var e=0;e<a[d].childNodes.length;e++)_isKHTML?a[d].childNodes[e].tagName&&a[d].childNodes[e].tagName.toUpperCase()==b&&(c[c.length]=a[d].childNodes[e]):a[d].childNodes[e].tagName==b&&(c[c.length]=a[d].childNodes[e]);return c};dtmlXMLLoaderObject.prototype.xslDoc=null;
dtmlXMLLoaderObject.prototype.setXSLParamValue=function(a,b,c){if(!c)c=this.xslDoc;if(c.responseXML)c=c.responseXML;a=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+a+"']",c,"http://www.w3.org/1999/XSL/Transform","single");if(a!=null)a.firstChild.nodeValue=b};
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(a,b){if(!a)a=this.xslDoc;if(a.responseXML)a=a.responseXML;if(!b)b=this.xmlDoc;if(b.responseXML)b=b.responseXML;if(_isIE){d=new ActiveXObject("Msxml2.DOMDocument.3.0");try{b.transformNodeToObject(a,d)}catch(c){d=b.transformNode(a)}}else{if(!this.XSLProcessor)this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(a);var d=this.XSLProcessor.transformToDocument(b)}return d};
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(a,b){var c=this.doXSLTransToObject(a,b);return typeof c=="string"?c:this.doSerialization(c)};dtmlXMLLoaderObject.prototype.doSerialization=function(a){if(!a)a=this.xmlDoc;if(a.responseXML)a=a.responseXML;return _isIE?a.xml:(new XMLSerializer).serializeToString(a)};
dhtmlxEventable=function(a){a.dhx_SeverCatcherPath="";a.attachEvent=function(a,c,d){a="ev_"+a.toLowerCase();this[a]||(this[a]=new this.eventCatcher(d||this));return a+":"+this[a].addEvent(c)};a.callEvent=function(a,c){a="ev_"+a.toLowerCase();return this[a]?this[a].apply(this,c):true};a.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]};a.eventCatcher=function(a){var c=[],d=function(){for(var d=true,f=0;f<c.length;f++)if(c[f]!=null)var g=c[f].apply(a,arguments),d=d&&g;return d};d.addEvent=
function(a){typeof a!="function"&&(a=eval(a));return a?c.push(a)-1:false};d.removeEvent=function(a){c[a]=null};return d};a.detachEvent=function(a){a!=false&&(a=a.split(":"),this[a[0]].removeEvent(a[1]))};a.detachAllEvents=function(){for(var a in this)a.indexOf("ev_")==0&&delete this[a]}};
dataProcessor.prototype={setTransactionMode:function(a,b){this._tMode=a;this._tSend=b},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=convertStringToBoolean(a)},setDataColumns:function(a){this._columns=typeof a=="string"?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=convertStringToBoolean(a)},enablePartialDataSend:function(a){this._changed=convertStringToBoolean(a)},setUpdateMode:function(a,
b){this.autoUpdate=a=="cell";this.updateMode=a;this.dnd=b},ignore:function(a,b){this._silent_mode=true;a.call(b||window);this._silent_mode=false},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a),c=c||"updated",e=this.obj.getUserData(a,this.action_param);e&&c=="updated"&&(c=e);b?(this.set_invalid(a,false),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,
this.action_param,""));b||this._clearUpdateFlag(a);this.markRow(a,b,c);b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);e&&(d=this.styles[e],b=true);if(this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(b=0;b<e.details.length;b++)if(e.details[b])this.obj[this._methods[1]](a,b,d)}},getState:function(a){return this.obj.getUserData(a,
this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}});this._invalid[a]=b},checkBeforeUpdate:function(){return true},sendData:function(a){if(!this._waitMode||!(this.obj.mytype=="tree"||this.obj._h2)){this.obj.editStop&&this.obj.editStop();if(typeof a=="undefined"||this._tSend)return this.sendAllData();if(this._in_progress[a])return false;this.messages=[];if(!this.checkBeforeUpdate(a)&&
this.callEvent("onValidatationError",[a,this.messages]))return false;this._beforeSendData(this._getRowData(a),a)}},_beforeSendData:function(a,b){if(!this.callEvent("onBeforeUpdate",[b,this.getState(b),a]))return false;this._sendData(a,b)},serialize:function(a,b){if(typeof a=="string")return a;if(typeof b!="undefined")return this.serialize_one(a,"");else{var c=[],d=[],e;for(e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));c.push("ids="+this.escape(d.join(",")));
return c.join("&")}},serialize_one:function(a,b){if(typeof a=="string")return a;var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push(this.escape((b||"")+d)+"="+this.escape(a[d]));return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return false;b&&(this._in_progress[b]=(new Date).valueOf());var c=new dtmlXMLLoaderObject(this.afterUpdate,this,true),d=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+
this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");this._tMode!="POST"?c.loadXML(d+(d.indexOf("?")!=-1?"&":"?")+this.serialize(a,b)):c.loadXML(d,true,this.serialize(a,b));this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=true,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidatationError",["",this.messages]))return false;if(this._tSend)this._sendData(this._getAllData());
else for(b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]&&!this.is_invalid(this.updatedRows[b])&&(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2)))break}},_getAllData:function(){for(var a={},b=false,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];!this._in_progress[d]&&!this.is_invalid(d)&&this.callEvent("onBeforeUpdate",[d,this.getState(d)])&&(a[d]=this._getRowData(d,
d+this.post_delim),b=true,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return a!=""}},clearVerificator:function(a){this.mandatoryFields[a]=false},findRow:function(a){for(var b=0,b=0;b<this.updatedRows.length;b++)if(a==this.updatedRows[b])break;return b},defineAction:function(a,b){if(!this._uActions)this._uActions=[];this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f=c!="error"&&c!="invalid";f||this.set_invalid(a,
c);if(this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];this._in_progress[e]!="wait"&&this.setUpdated(a,false);switch(c){case "update":case "updated":case "inserted":case "insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case "delete":case "deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}this._in_progress[e]!="wait"?(f&&this.obj.setUserData(a,
this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,true,this.obj.getUserData(a,this.action_param)));this.callEvent("onAfterUpdate",[a,c,b,d])},afterUpdate:function(a,b,c,d,e){e.getXMLTopNode("data");if(e.xmlDoc.responseXML){b=e.doXPath("//data/action");for(c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("type"),f=d.getAttribute("sid"),g=d.getAttribute("tid");a.afterUpdateCallback(f,g,e,d)}a.finalizeUpdate()}},finalizeUpdate:function(){this._waitMode&&
this._waitMode--;(this.obj.mytype=="tree"||this.obj._h2)&&this.updatedRows.length&&this.sendData();this.callEvent("onAfterUpdateFinish",[]);this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a;this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2E3;this._user=b||(new Date).valueOf();
this._need_update=false;this._loader=null;this._update_busy=false;this.attachEvent("onAfterUpdate",function(a,b,c,g){this.afterAutoUpdate(a,b,c,g)});this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return b=="collision"?(this._need_update=true,false):true},fullSync:function(){if(this._need_update==true)this._need_update=false,this.loadUpdate();return true},getUpdates:function(a,b){if(this._update_busy)return false;
else this._update_busy=true;this._loader=this._loader||new dtmlXMLLoaderObject(true);this._loader.async=true;this._loader.waitCall=b;this._loader.loadXML(a)},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),b=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&"),b=b.replace("editing=true&",
"");this.getUpdates(b,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));b=a._loader.doXPath("//update");if(b.length){a._silent_mode=true;for(var d=0;d<b.length;d++){var e=b[d].getAttribute("status"),f=b[d].getAttribute("id"),g=b[d].getAttribute("parent");switch(e){case "inserted":a.callEvent("insertCallback",[b[d],f,g]);break;case "updated":a.callEvent("updateCallback",[b[d],f,g]);break;case "deleted":a.callEvent("deleteCallback",[b[d],f,g])}}a._silent_mode=
false}a._update_busy=false;a=null})}};
if(window.dhtmlXGridObject)dhtmlXGridObject.prototype._init_point_connector=dhtmlXGridObject.prototype._init_point,dhtmlXGridObject.prototype._init_point=function(){var a=function(a){a=a.replace(/(\?|\&)connector[^\f]*/g,"");return a+(a.indexOf("?")!=-1?"&":"?")+"connector=true"+(this.hdr.rows.length>0?"&dhx_no_header=1":"")+(this._connector_sorting||"")+(this._connector_filter||"")},b=function(b,c,f){this._connector_sorting="&dhx_sort["+c+"]="+f;return a.call(this,b)},c=function(b,c,f){for(var g=
0;g<c.length;g++)c[g]="dhx_filter["+c[g]+"]="+encodeURIComponent(f[g]);this._connector_filter="&"+c.join("&");return a.call(this,b)};this.attachEvent("onCollectValues",function(a){return this._con_f_used[a]?typeof this._con_f_used[a]=="object"?this._con_f_used[a]:false:true});this.attachEvent("onDynXLS",function(){this.xmlFileUrl=a.call(this,this.xmlFileUrl);return true});this.attachEvent("onBeforeSorting",function(a,c,f){if(c=="connector"){var g=this;this.clearAndLoad(b.call(this,this.xmlFileUrl,
a,f),function(){g.setSortImgState(true,a,f)});return false}return true});this.attachEvent("onFilterStart",function(a,b){return this._con_f_used.length?(this.clearAndLoad(c.call(this,this.xmlFileUrl,a,b)),false):true});this.attachEvent("onXLE",function(){});this._init_point_connector&&this._init_point_connector()},dhtmlXGridObject.prototype._con_f_used=[],dhtmlXGridObject.prototype._in_header_connector_text_filter=function(a,b){this._con_f_used[b]||(this._con_f_used[b]=1);return this._in_header_text_filter(a,
b)},dhtmlXGridObject.prototype._in_header_connector_select_filter=function(a,b){this._con_f_used[b]||(this._con_f_used[b]=2);return this._in_header_select_filter(a,b)},dhtmlXGridObject.prototype.load_connector=dhtmlXGridObject.prototype.load,dhtmlXGridObject.prototype.load=function(a,b,c){if(!this._colls_loaded&&this.cellType){for(var d=[],e=0;e<this.cellType.length;e++)(this.cellType[e].indexOf("co")==0||this._con_f_used[e]==2)&&d.push(e);d.length&&(arguments[0]+=(arguments[0].indexOf("?")!=-1?"&":
"?")+"connector=true&dhx_colls="+d.join(","))}return this.load_connector.apply(this,arguments)},dhtmlXGridObject.prototype._parseHead_connector=dhtmlXGridObject.prototype._parseHead,dhtmlXGridObject.prototype._parseHead=function(a,b,c){this._parseHead_connector.apply(this,arguments);if(!this._colls_loaded){for(var d=this.xmlLoader.doXPath("./coll_options",arguments[0]),e=0;e<d.length;e++){var f=d[e].getAttribute("for"),g=[],i=null;this.cellType[f]=="combo"&&(i=this.getColumnCombo(f));this.cellType[f].indexOf("co")==
0&&(i=this.getCombo(f));for(var h=this.xmlLoader.doXPath("./item",d[e]),k=0;k<h.length;k++){var j=h[k].getAttribute("value");if(i){var l=h[k].getAttribute("label")||j;i.addOption?i.addOption([[j,l]]):i.put(j,l);g[g.length]=l}else g[g.length]=j}this._con_f_used[f*1]&&(this._con_f_used[f*1]=g)}this._colls_loaded=true}};
if(window.dataProcessor)dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(a){this.init_original(a);a._dataprocessor=this;this.setTransactionMode("POST",true);this.serverProcessor+=(this.serverProcessor.indexOf("?")!=-1?"&":"?")+"editing=true"};dhtmlxError.catchError("LoadXML",function(a,b,c){c[0].status!=0&&alert(c[0].responseText)});window.dhtmlXScheduler=window.scheduler={version:3};dhtmlxEventable(scheduler);
scheduler.init=function(a,b,c){b=b||new Date;c=c||"week";scheduler.date.init();this._obj=typeof a=="string"?document.getElementById(a):a;this._els=[];this._scroll=true;this._quirks=_isIE&&document.compatMode=="BackCompat";this._quirks7=_isIE&&navigator.appVersion.indexOf("MSIE 8")==-1;this.get_elements();this.init_templates();this.set_actions();dhtmlxEvent(window,"resize",function(){window.clearTimeout(scheduler._resize_timer);scheduler._resize_timer=window.setTimeout(function(){scheduler.callEvent("onSchedulerResize",
[])&&scheduler.update_view()},100)});this.set_sizes();scheduler.callEvent("onSchedulerReady",[]);this.setCurrentView(b,c)};scheduler.xy={nav_height:22,min_event_height:40,scale_width:50,bar_height:20,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140};scheduler.keys={edit_save:13,edit_cancel:27};
scheduler.set_sizes=function(){var a=this._x=this._obj.clientWidth-this.xy.margin_left,b=this._y=this._obj.clientHeight-this.xy.margin_top,c=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,d=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],a,this.xy.nav_height,0,0);this.set_xy(this._els.dhx_cal_header[0],a-c,this.xy.scale_height,d,this.xy.nav_height+(this._quirks?-1:1));c=this._els.dhx_cal_navline[0].offsetHeight;if(c>0)this.xy.nav_height=c;c=this.xy.scale_height+
this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],a,b-(c+2),0,c+2)};scheduler.set_xy=function(a,b,c,d,e){a.style.width=Math.max(0,b)+"px";a.style.height=Math.max(0,c)+"px";if(arguments.length>3)a.style.left=d+"px",a.style.top=e+"px"};
scheduler.get_elements=function(){for(var a=this._obj.getElementsByTagName("DIV"),b=0;b<a.length;b++){var c=a[b].className;this._els[c]||(this._els[c]=[]);this._els[c].push(a[b]);if(c=scheduler.locale.labels[a[b].getAttribute("name")||c])a[b].innerHTML=c}};
scheduler.set_actions=function(){for(var a in this._els)if(this._click[a])for(var b=0;b<this._els[a].length;b++)this._els[a][b].onclick=scheduler._click[a];this._obj.onselectstart=function(){return false};this._obj.onmousemove=function(a){scheduler._on_mouse_move(a||event)};this._obj.onmousedown=function(a){scheduler._on_mouse_down(a||event)};this._obj.onmouseup=function(a){scheduler._on_mouse_up(a||event)};this._obj.ondblclick=function(a){scheduler._on_dbl_click(a||event)}};
scheduler.select=function(a){if(!this._table_view&&this.getEvent(a)._timed&&this._select_id!=a)this.editStop(false),this.unselect(),this._select_id=a,this.updateEvent(a)};scheduler.unselect=function(a){if(!(a&&a!=this._select_id))a=this._select_id,this._select_id=null,a&&this.updateEvent(a)};scheduler.getState=function(){return{mode:this._mode,date:this._date,min_date:this._min_date,max_date:this._max_date,editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event}};
scheduler._click={dhx_cal_data:function(a){var b=a?a.target:event.srcElement,c=scheduler._locate_event(b);if(!(c&&!scheduler.callEvent("onClick",[c,a||event])||scheduler.config.readonly))if(c){if(scheduler.select(c),a=b.className,a.indexOf("_icon")!=-1)scheduler._click.buttons[a.split(" ")[1].replace("icon_","")](c)}else scheduler._close_not_saved()},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(a,b){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+
"_start"](scheduler._date),b||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.setCurrentView(new Date)},dhx_cal_tab:function(){var a=this.getAttribute("name"),a=a.substring(0,a.search("_tab"));scheduler.setCurrentView(scheduler._date,a)},buttons:{"delete":function(a){var b=scheduler.locale.labels.confirm_deleting;(!b||confirm(b))&&scheduler.deleteEvent(a)},edit:function(a){scheduler.edit(a)},save:function(){scheduler.editStop(true)},details:function(a){scheduler.showLightbox(a)},cancel:function(){scheduler.editStop(false)}}};
scheduler.addEventNow=function(a,b,c){var d={};a&&a.constructor.toString().match(/object/i)!==null&&(d=a,a=null);var e=(this.config.event_duration||this.config.time_step)*6E4;a||(a=Math.round((new Date).valueOf()/e)*e);var f=new Date(a);if(!b)b=this.config.first_hour,b>f.getHours()&&(f.setHours(b),a=f.valueOf()),b=a+e;a=new Date(b);f.valueOf()==a.valueOf()&&a.setTime(a.valueOf()+e);d.start_date=d.start_date||f;d.end_date=d.end_date||a;d.text=d.text||this.locale.labels.new_event;d.id=this._drag_id=
this.uid();this._drag_mode="new-size";this._loading=true;this.addEvent(d);this.callEvent("onEventCreated",[this._drag_id,c]);this._loading=false;this._drag_event={};this._on_mouse_up(c)};
scheduler._on_dbl_click=function(a,b){b=b||a.target||a.srcElement;if(!this.config.readonly){var c=b.className.split(" ")[0];switch(c){case "dhx_scale_holder":case "dhx_scale_holder_now":case "dhx_month_body":case "dhx_wa_day_data":if(!scheduler.config.dblclick_create)break;c=this._mouse_coords(a);c=this._min_date.valueOf()+(c.y*this.config.time_step+(this._table_view?0:c.x)*1440)*6E4;c=this._correct_shift(c);this.addEventNow(c,null,a);break;case "dhx_body":case "dhx_wa_ev_body":case "dhx_cal_event_line":case "dhx_cal_event_clear":c=
this._locate_event(b);if(!this.callEvent("onDblClick",[c,a]))break;this.config.details_on_dblclick||this._table_view||!this.getEvent(c)._timed?this.showLightbox(c):this.edit(c);break;case "":if(b.parentNode)return scheduler._on_dbl_click(a,b.parentNode);default:(c=this["dblclick_"+c])&&c.call(this,a)}}};
scheduler._mouse_coords=function(a){var b;b=document.body;var c=document.documentElement;b=a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:{x:a.clientX+(b.scrollLeft||c.scrollLeft||0)-b.clientLeft,y:a.clientY+(b.scrollTop||c.scrollTop||0)-b.clientTop};b.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width);b.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop;b.ev=a;if(a=this["mouse_"+this._mode])return a.call(this,b);
if(this._table_view){a=0;for(a=1;a<this._colsS.heights.length;a++)if(this._colsS.heights[a]>b.y)break;b.y=(Math.max(0,Math.ceil(b.x/this._cols[0])-1)+Math.max(0,a-1)*7)*1440/this.config.time_step;b.x=0}else b.x=Math.max(0,Math.ceil(b.x/this._cols[0])-1),b.y=Math.max(0,Math.ceil(b.y*60/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step);return b};
scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var a=scheduler.locale.labels.confirm_closing;(!a||confirm(a))&&scheduler.editStop(scheduler.config.positive_closing)}};scheduler._correct_shift=function(a,b){return a-((new Date(scheduler._min_date)).getTimezoneOffset()-(new Date(a)).getTimezoneOffset())*6E4*(b?-1:1)};
scheduler._on_mouse_move=function(a){if(this._drag_mode){var b=this._mouse_coords(a);if(!this._drag_pos||b.custom||this._drag_pos.x!=b.x||this._drag_pos.y!=b.y){this._edit_id!=this._drag_id&&this._close_not_saved();this._drag_pos=b;if(this._drag_mode=="create"){this._close_not_saved();this._loading=true;var c=this._min_date.valueOf()+(b.y*this.config.time_step+(this._table_view?0:b.x)*1440)*6E4,c=this._correct_shift(c);if(!this._drag_start){this._drag_start=c;return}var d=c;if(d==this._drag_start)return;
this._drag_id=this.uid();this.addEvent(new Date(this._drag_start),new Date(d),this.locale.labels.new_event,this._drag_id,b.fields);this.callEvent("onEventCreated",[this._drag_id,a]);this._loading=false;this._drag_mode="new-size"}a=this.getEvent(this._drag_id);if(this._drag_mode=="move")c=this._min_date.valueOf()+(b.y*this.config.time_step+b.x*1440)*6E4,!b.custom&&this._table_view&&(c+=this.date.time_part(a.start_date)*1E3),c=this._correct_shift(c),d=a.end_date.valueOf()-(a.start_date.valueOf()-c);
else{c=a.start_date.valueOf();if(this._table_view)d=this._min_date.valueOf()+b.y*this.config.time_step*6E4+(b.custom?0:864E5),this._mode=="month"&&(d=this._correct_shift(d,false));else if(d=this.date.date_part(new Date(a.end_date)).valueOf()+b.y*this.config.time_step*6E4,this._els.dhx_cal_data[0].style.cursor="s-resize",this._mode=="week"||this._mode=="day")d=this._correct_shift(d);if(this._drag_mode=="new-size")if(d<=this._drag_start)var e=b.shift||(this._table_view&&!b.custom?864E5:0),c=d-(b.shift?
0:e),d=this._drag_start+(e||this.config.time_step*6E4);else c=this._drag_start;else d<=c&&(d=c+this.config.time_step*6E4)}b=new Date(d-1);c=new Date(c);if(this._table_view||b.getDate()==c.getDate()&&b.getHours()<this.config.last_hour||scheduler._wa&&scheduler._wa._dnd)a.start_date=c,a.end_date=new Date(d),this.config.update_render?this.update_view():this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(a){a.className+=" dhx_in_move"})}}else scheduler.checkEvent("onMouseMove")&&
this.callEvent("onMouseMove",[this._locate_event(a.target||a.srcElement),a])};scheduler._on_mouse_context=function(a,b){return this.callEvent("onContextMenu",[this._locate_event(b),a])};
scheduler._on_mouse_down=function(a,b){if(!this.config.readonly&&!this._drag_mode){b=b||a.target||a.srcElement;if(a.button==2||a.ctrlKey)return this._on_mouse_context(a,b);switch(b.className.split(" ")[0]){case "dhx_cal_event_line":case "dhx_cal_event_clear":if(this._table_view)this._drag_mode="move";break;case "dhx_header":case "dhx_title":case "dhx_wa_ev_body":this._drag_mode="move";break;case "dhx_footer":this._drag_mode="resize";break;case "dhx_scale_holder":case "dhx_scale_holder_now":case "dhx_month_body":case "dhx_matrix_cell":this._drag_mode=
"create";break;case "":if(b.parentNode)return scheduler._on_mouse_down(a,b.parentNode);default:this._drag_id=this._drag_mode=null}if(this._drag_mode){var c=this._locate_event(b);!this.config["drag_"+this._drag_mode]||!this.callEvent("onBeforeDrag",[c,this._drag_mode,a])?this._drag_mode=this._drag_id=0:(this._drag_id=c,this._drag_event=scheduler._lame_copy({},this._copy_event(this.getEvent(this._drag_id)||{})))}this._drag_start=null}};
scheduler._on_mouse_up=function(a){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var b=this.getEvent(this._drag_id);if(this._drag_event._dhx_changed||!this._drag_event.start_date||b.start_date.valueOf()!=this._drag_event.start_date.valueOf()||b.end_date.valueOf()!=this._drag_event.end_date.valueOf()){var c=this._drag_mode=="new-size";if(this.callEvent("onBeforeEventChanged",[b,a,c]))if(c&&this.config.edit_on_create){this.unselect();this._new_event=new Date;if(this._table_view||
this.config.details_on_create)return this._drag_mode=null,this.showLightbox(this._drag_id);this._drag_pos=true;this._select_id=this._edit_id=this._drag_id}else this._new_event||this.callEvent(c?"onEventAdded":"onEventChanged",[this._drag_id,this.getEvent(this._drag_id)]);else c?this.deleteEvent(b.id,true):(this._drag_event._dhx_changed=false,scheduler._lame_copy(b,this._drag_event),this.updateEvent(b.id))}this._drag_pos&&this.render_view_data()}this._drag_pos=this._drag_mode=null};
scheduler.update_view=function(){this._reset_scale();if(this._load_mode&&this._load())return this._render_wait=true;this.render_view_data()};
scheduler.setCurrentView=function(a,b){a=a||this._date;b=b||this._mode;if(this.callEvent("onBeforeViewChange",[this._mode,this._date,b,a])){var c=this._mode==b&&this.config.preserve_scroll?this._els.dhx_cal_data[0].scrollTop:false;if(this[this._mode+"_view"]&&b&&this._mode!=b)this[this._mode+"_view"](false);this._close_not_saved();this._els.dhx_multi_day&&(this._els.dhx_multi_day[0].parentNode.removeChild(this._els.dhx_multi_day[0]),this._els.dhx_multi_day=null);this._mode=b;this._date=a;this._table_view=
this._mode=="month";for(var d=this._els.dhx_cal_tab,e=0;e<d.length;e++)d[e].className="dhx_cal_tab"+(d[e].getAttribute("name")==this._mode+"_tab"?" active":"");(d=this[this._mode+"_view"])?d(true):this.update_view();if(typeof c=="number")this._els.dhx_cal_data[0].scrollTop=c;this.callEvent("onViewChange",[this._mode,this._date])}};
scheduler._render_x_header=function(a,b,c,d){var e=document.createElement("DIV");e.className="dhx_scale_bar";this.set_xy(e,this._cols[a]-1,this.xy.scale_height-2,b,0);e.innerHTML=this.templates[this._mode+"_scale_date"](c,this._mode);d.appendChild(e)};
scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var a=this._els.dhx_cal_header[0],b=this._els.dhx_cal_data[0],c=this.config;a.innerHTML="";b.scrollTop=0;b.innerHTML="";var d=(c.readonly||!c.drag_resize?" dhx_resize_denied":"")+(c.readonly||!c.drag_move?" dhx_move_denied":"");if(d)b.className="dhx_cal_data"+d;this._cols=[];this._colsS={height:0};this._dy_shift=0;this.set_sizes();var d=parseInt(a.style.width),e=0,f,g,i,h;g=this.date[this._mode+"_start"](new Date(this._date.valueOf()));
f=i=this._table_view?scheduler.date.week_start(g):g;h=this.date.date_part(new Date);var k=scheduler.date.add(g,1,this._mode),j=7;this._table_view||((j=this.date["get_"+this._mode+"_end"])&&(k=j(g)),j=Math.round((k.valueOf()-g.valueOf())/864E5));this._min_date=f;this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](g,k,this._mode);for(k=0;k<j;k++){this._cols[k]=Math.floor(d/(j-k));this._render_x_header(k,e,f,a);if(!this._table_view){var l=document.createElement("DIV"),m="dhx_scale_holder";
f.valueOf()==h.valueOf()&&(m="dhx_scale_holder_now");l.className=m+" "+this.templates.week_date_class(f,h);this.set_xy(l,this._cols[k]-1,c.hour_size_px*(c.last_hour-c.first_hour),e+this.xy.scale_width+1,0);b.appendChild(l);this.callEvent("onScaleAdd",[l,f])}f=this.date.add(f,1,"day");d-=this._cols[k];e+=this._cols[k];this._colsS[k]=(this._cols[k-1]||0)+(this._colsS[k-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS.col_length=j+1}this._max_date=f;this._colsS[j]=this._cols[j-1]+this._colsS[j-
1];if(this._table_view)this._reset_month_scale(b,g,i);else{this._reset_hours_scale(b,g,i);if(c.multi_day)this._els.dhx_multi_day&&(this._els.dhx_multi_day[0].parentNode.removeChild(this._els.dhx_multi_day[0]),this._els.dhx_multi_day=null),a=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,c=document.createElement("DIV"),c.className="dhx_multi_day",c.style.visibility="hidden",this.set_xy(c,this._colsS[this._colsS.col_length-1]+this.xy.scroll_width,0,0,a),b.parentNode.insertBefore(c,
b),d=c.cloneNode(true),d.className="dhx_multi_day_icon",d.style.visibility="hidden",this.set_xy(d,this.xy.scale_width,0,0,a),c.appendChild(d),this._els.dhx_multi_day=[c,d],this._els.dhx_multi_day[0].onclick=this._click.dhx_cal_data;if(this.config.mark_now&&(c=new Date,c<this._max_date&&c>this._min_date&&c.getHours()>=this.config.first_hour&&c.getHours()<this.config.last_hour))a=this.locate_holder_day(c),c=c.getHours()*60+c.getMinutes(),d=document.createElement("DIV"),d.className="dhx_now_time",d.style.top=
Math.round((c*6E4-this.config.first_hour*36E5)*this.config.hour_size_px/36E5)%(this.config.hour_size_px*24)+1+"px",b.childNodes[a].appendChild(d)}}};
scheduler._reset_hours_scale=function(a){var b=document.createElement("DIV");b.className="dhx_scale_holder";for(var c=new Date(1980,1,1,this.config.first_hour,0,0),d=this.config.first_hour*1;d<this.config.last_hour;d++){var e=document.createElement("DIV");e.className="dhx_scale_hour";e.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";e.style.width=this.xy.scale_width+"px";e.innerHTML=scheduler.templates.hour_scale(c);b.appendChild(e);c=this.date.add(c,1,"hour")}a.appendChild(b);if(this.config.scroll_hour)a.scrollTop=
this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour)};
scheduler._reset_month_scale=function(a,b,c){var d=scheduler.date.add(b,1,"month"),e=new Date;this.date.date_part(e);this.date.date_part(c);var f=Math.ceil(Math.round((d.valueOf()-c.valueOf())/864E5)/7),g=[],i=Math.floor(a.clientHeight/f)-22;this._colsS.height=i+22;for(var h=this._colsS.heights=[],k=0;k<=7;k++)g[k]=" style='height:"+i+"px; width:"+((this._cols[k]||0)-1)+"px;' ";i=0;this._min_date=c;for(var j="<table cellpadding='0' cellspacing='0'>",k=0;k<f;k++){j+="<tr>";for(var l=0;l<7;l++){j+=
"<td";var m="";c<b?m="dhx_before":c>=d?m="dhx_after":c.valueOf()==e.valueOf()&&(m="dhx_now");j+=" class='"+m+" "+this.templates.month_date_class(c,e)+"' ";j+="><div class='dhx_month_head'>"+this.templates.month_day(c)+"</div><div class='dhx_month_body' "+g[l]+"></div></td>";c=this.date.add(c,1,"day")}j+="</tr>";h[k]=i;i+=this._colsS.height}j+="</table>";this._max_date=c;a.innerHTML=j;return c};
scheduler.getLabel=function(a,b){for(var c=this.config.lightbox.sections,d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""};scheduler.updateCollection=function(a,b){var c=scheduler.serverList(a);if(!c)return false;c.splice(0,c.length);c.push.apply(c,b||[]);scheduler.callEvent("onOptionsLoad",[]);scheduler.resetLightbox();return true};scheduler._lame_copy=function(a,b){for(var c in b)a[c]=b[c];return a};
scheduler.date={init:function(){for(var a=scheduler.locale.date.month_short,b=scheduler.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;a=scheduler.locale.date.month_full;b=scheduler.locale.date.month_full_hash={};for(c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a},time_part:function(a){return(a.valueOf()/1E3-a.getTimezoneOffset()*60)%86400},week_start:function(a){var b=a.getDay();scheduler.config.start_on_monday&&
(b===0?b=6:b--);return this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){a.setDate(1);return this.date_part(a)},year_start:function(a){a.setMonth(0);return this.month_start(a)},day_start:function(a){return this.date_part(a)},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case "day":d.setDate(d.getDate()+b);if(a.getDate()==d.getDate()&&b){do d.setTime(d.getTime()+36E5);while(a.getDate()==d.getDate())}break;case "week":d.setDate(d.getDate()+7*b);break;case "month":d.setMonth(d.getMonth()+
b);break;case "year":d.setYear(d.getFullYear()+b);break;case "hour":d.setHours(d.getHours()+b);break;case "minute":d.setMinutes(d.getMinutes()+b);break;default:return scheduler.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return a<10?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case "%d":return'"+scheduler.date.to_fixed(date.getDate())+"';case "%m":return'"+scheduler.date.to_fixed((date.getMonth()+1))+"';case "%j":return'"+date.getDate()+"';
case "%n":return'"+(date.getMonth()+1)+"';case "%y":return'"+scheduler.date.to_fixed(date.getFullYear()%100)+"';case "%Y":return'"+date.getFullYear()+"';case "%D":return'"+scheduler.locale.date.day_short[date.getDay()]+"';case "%l":return'"+scheduler.locale.date.day_full[date.getDay()]+"';case "%M":return'"+scheduler.locale.date.month_short[date.getMonth()]+"';case "%F":return'"+scheduler.locale.date.month_full[date.getMonth()]+"';case "%h":return'"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';
case "%g":return'"+((date.getHours()+11)%12+1)+"';case "%G":return'"+date.getHours()+"';case "%H":return'"+scheduler.date.to_fixed(date.getHours())+"';case "%i":return'"+scheduler.date.to_fixed(date.getMinutes())+"';case "%a":return'"+(date.getHours()>11?"pm":"am")+"';case "%A":return'"+(date.getHours()>11?"PM":"AM")+"';case "%s":return'"+scheduler.date.to_fixed(date.getSeconds())+"';case "%W":return'"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+"';default:return a}});b&&(a=a.replace(/date\.get/g,
"date.getUTC"));return new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.split(/[^0-9a-zA-Z]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case "%j":case "%d":c+="set[2]=temp["+e+"]||1;";break;case "%n":case "%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case "%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case "%g":case "%G":case "%h":case "%H":c+="set[3]=temp["+e+"]||0;";break;case "%i":c+="set[4]=temp["+e+"]||0;";break;case "%Y":c+=
"set[0]=temp["+e+"]||0;";break;case "%a":case "%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case "%s":c+="set[5]=temp["+e+"]||0;";break;case "%M":c+="set[1]=scheduler.locale.date.month_short_hash[temp["+e+"]]||0;";break;case "%F":c+="set[1]=scheduler.locale.date.month_full_hash[temp["+e+"]]||0;"}d="set[0],set[1],set[2],set[3],set[4],set[5]";b&&(d=" Date.UTC("+d+")");return new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+d+");")},getISOWeek:function(a){if(!a)return false;
var b=a.getDay();b===0&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));a=c.getFullYear();c=Math.round((c.getTime()-(new Date(a,0,1)).getTime())/864E5);return 1+Math.floor(c/7)},getUTCISOWeek:function(a){return this.getISOWeek(a)}};
scheduler.locale={date:{month_full:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),month_short:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),day_full:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),day_short:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",")},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",
icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda"}};
scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",hour_size_px:42,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:false,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,click_form_details:0,cascade_event_display:false,cascade_event_count:4,cascade_event_margin:30,drag_lightbox:true,preserve_scroll:true,
server_utc:false,positive_closing:false,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:true},{name:"time",height:72,type:"time",map_to:"auto"}]},repeat_date_of_end:"01.01.2010"};scheduler.templates={};
scheduler.init_templates=function(){var a=scheduler.date.date_to_str,b=scheduler.config;(function(a,b){for(var e in b)a[e]||(a[e]=b[e])})(scheduler.templates,{day_date:a(b.default_date),month_date:a(b.month_date),week_date:function(a,b){return scheduler.templates.day_date(a)+" \u2013 "+scheduler.templates.day_date(scheduler.date.add(b,-1,"day"))},day_scale_date:a(b.default_date),month_scale_date:a(b.week_date),week_scale_date:a(b.day_date),hour_scale:a(b.hour_date),time_picker:a(b.hour_date),event_date:a(b.hour_date),
month_day:a(b.month_day),xml_date:scheduler.date.str_to_date(b.xml_date,b.server_utc),load_format:a(b.load_date,b.server_utc),xml_format:a(b.xml_date,b.server_utc),api_date:scheduler.date.str_to_date(b.api_date),event_header:function(a,b){return scheduler.templates.event_date(a)+" - "+scheduler.templates.event_date(b)},event_text:function(a,b,e){return e.text},event_class:function(){return""},month_date_class:function(){return""},week_date_class:function(){return""},event_bar_date:function(a){return scheduler.templates.event_date(a)+
" "},event_bar_text:function(a,b,e){return e.text}});this.callEvent("onTemplatesReady",[])};scheduler.uid=function(){if(!this._seed)this._seed=(new Date).valueOf();return this._seed++};scheduler._events={};scheduler.clearAll=function(){this._events={};this._loaded={};this.clear_view()};
scheduler.addEvent=function(a,b,c,d,e){if(!arguments.length)return this.addEventNow();var f=a;if(arguments.length!=1)f=e||{},f.start_date=a,f.end_date=b,f.text=c,f.id=d;f.id=f.id||scheduler.uid();f.text=f.text||"";if(typeof f.start_date=="string")f.start_date=this.templates.api_date(f.start_date);if(typeof f.end_date=="string")f.end_date=this.templates.api_date(f.end_date);var g=(this.config.event_duration||this.config.time_step)*6E4;f.start_date.valueOf()==f.end_date.valueOf()&&f.end_date.setTime(f.end_date.valueOf()+
g);f._timed=this.is_one_day_event(f);g=!this._events[f.id];this._events[f.id]=f;this.event_updated(f);this._loading||this.callEvent(g?"onEventAdded":"onEventChanged",[f.id,f])};scheduler.deleteEvent=function(a,b){var c=this._events[a];if(b||this.callEvent("onBeforeEventDelete",[a,c])&&this.callEvent("onConfirmedBeforeEventDelete",[a,c]))c&&(delete this._events[a],this.unselect(a),this.event_updated(c)),this.callEvent("onEventDeleted",[a])};scheduler.getEvent=function(a){return this._events[a]};
scheduler.setEvent=function(a,b){this._events[a]=b};scheduler.for_rendered=function(a,b){for(var c=this._rendered.length-1;c>=0;c--)this._rendered[c].getAttribute("event_id")==a&&b(this._rendered[c],c)};scheduler.changeEventId=function(a,b){if(a!=b){var c=this._events[a];if(c)c.id=b,this._events[b]=c,delete this._events[a];this.for_rendered(a,function(a){a.setAttribute("event_id",b)});if(this._select_id==a)this._select_id=b;if(this._edit_id==a)this._edit_id=b;this.callEvent("onEventIdChange",[a,b])}};
(function(){for(var a="text,Text,start_date,StartDate,end_date,EndDate".split(","),b=function(a){return function(b){return scheduler.getEvent(b)[a]}},c=function(a){return function(b,c){var d=scheduler.getEvent(b);d[a]=c;d._changed=true;d._timed=this.is_one_day_event(d);scheduler.event_updated(d,true)}},d=0;d<a.length;d+=2)scheduler["getEvent"+a[d+1]]=b(a[d]),scheduler["setEvent"+a[d+1]]=c(a[d])})();scheduler.event_updated=function(a){this.is_visible_events(a)?this.render_view_data():this.clear_event(a.id)};
scheduler.is_visible_events=function(a){return a.start_date<this._max_date&&this._min_date<a.end_date};scheduler.is_one_day_event=function(a){var b=a.end_date.getDate()-a.start_date.getDate();return b?(b<0&&(b=Math.ceil((a.end_date.valueOf()-a.start_date.valueOf())/864E5)),b==1&&!a.end_date.getHours()&&!a.end_date.getMinutes()&&(a.start_date.getHours()||a.start_date.getMinutes())):a.start_date.getMonth()==a.end_date.getMonth()&&a.start_date.getFullYear()==a.end_date.getFullYear()};
scheduler.get_visible_events=function(){var a=[],b=this["filter_"+this._mode],c;for(c in this._events)if(this.is_visible_events(this._events[c])&&(this._table_view||this.config.multi_day||this._events[c]._timed))(!b||b(c,this._events[c]))&&a.push(this._events[c]);return a};
scheduler.render_view_data=function(a,b){if(!a){if(this._not_render){this._render_wait=true;return}this._render_wait=false;this.clear_view();a=this.get_visible_events()}if(this.config.multi_day&&!this._table_view){for(var c=[],d=[],e=0;e<a.length;e++)a[e]._timed?c.push(a[e]):d.push(a[e]);this._rendered_location=this._els.dhx_multi_day[0];this._table_view=true;this.render_data(d,b);this._table_view=false;this._rendered_location=this._els.dhx_cal_data[0];this._table_view=false;this.render_data(c,b)}else this._rendered_location=
this._els.dhx_cal_data[0],this.render_data(a,b)};scheduler.render_data=function(a,b){for(var a=this._pre_render_events(a,b),c=0;c<a.length;c++)this._table_view?this.render_event_bar(a[c]):this.render_event(a[c])};
scheduler._pre_render_events=function(a,b){var c=this.xy.bar_height,d=this._colsS.heights,e=this._colsS.heights=[0,0,0,0,0,0,0],f=this._els.dhx_cal_data[0],a=this._table_view?this._pre_render_events_table(a,b):this._pre_render_events_line(a,b);if(this._table_view)if(b)this._colsS.heights=d;else if(d=f.firstChild,d.rows){for(f=0;f<d.rows.length;f++){e[f]++;if(e[f]*c>this._colsS.height-22){for(var g=d.rows[f].cells,i=0;i<g.length;i++)g[i].childNodes[1].style.height=e[f]*c+"px";e[f]=(e[f-1]||0)+g[0].offsetHeight}e[f]=
(e[f-1]||0)+d.rows[f].cells[0].offsetHeight}e.unshift(0);if(d.parentNode.offsetHeight<d.parentNode.scrollHeight&&!d._h_fix){for(f=0;f<d.rows.length;f++)c=d.rows[f].cells[6].childNodes[0],e=c.offsetWidth-scheduler.xy.scroll_width+"px",c.style.width=e,c.nextSibling.style.width=e;d._h_fix=true}}else if(!a.length&&this._els.dhx_multi_day[0].style.visibility=="visible"&&(e[0]=-1),a.length||e[0]==-1)d=(e[0]+1)*c+1+"px",f.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+
parseInt(d)+"px",f.style.height=this._obj.offsetHeight-parseInt(f.style.top)-(this.xy.margin_top||0)+"px",f=this._els.dhx_multi_day[0],f.style.height=d,f.style.visibility=e[0]==-1?"hidden":"visible",f=this._els.dhx_multi_day[1],f.style.height=d,f.style.visibility=e[0]==-1?"hidden":"visible",f.className=e[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(e[0]+1)*c,e[0]=0;return a};
scheduler._get_event_sday=function(a){return Math.floor((a.start_date.valueOf()-this._min_date.valueOf())/864E5)};
scheduler._pre_render_events_line=function(a,b){a.sort(function(a,b){return a.start_date.valueOf()==b.start_date.valueOf()?a.id>b.id?1:-1:a.start_date>b.start_date?1:-1});for(var c=[],d=[],e=0;e<a.length;e++){var f=a[e],g=f.start_date.getHours(),i=f.end_date.getHours();f._sday=this._get_event_sday(f);c[f._sday]||(c[f._sday]=[]);if(!b){f._inner=false;for(var h=c[f._sday];h.length&&h[h.length-1].end_date<=f.start_date;)h.splice(h.length-1,1);for(var k=false,j=0;j<h.length;j++)if(h[j].end_date.valueOf()<
f.start_date.valueOf()){k=true;f._sorder=h[j]._sorder;h.splice(j,1);f._inner=true;break}if(h.length)h[h.length-1]._inner=true;if(!k)if(h.length)if(h.length<=h[h.length-1]._sorder){if(h[h.length-1]._sorder)for(j=0;j<h.length;j++){for(var l=false,k=0;k<h.length;k++)if(h[k]._sorder==j){l=true;break}if(!l){f._sorder=j;break}}else f._sorder=0;f._inner=true}else{l=h[0]._sorder;for(j=1;j<h.length;j++)if(h[j]._sorder>l)l=h[j]._sorder;f._sorder=l+1;f._inner=false}else f._sorder=0;h.push(f);h.length>(h.max_count||
0)?(h.max_count=h.length,f._count=h.length):f._count=f._count?f._count:1}if(g<this.config.first_hour||i>=this.config.last_hour)if(d.push(f),a[e]=f=this._copy_event(f),g<this.config.first_hour&&(f.start_date.setHours(this.config.first_hour),f.start_date.setMinutes(0)),i>=this.config.last_hour&&(f.end_date.setMinutes(0),f.end_date.setHours(this.config.last_hour)),f.start_date>f.end_date||g==this.config.last_hour)a.splice(e,1),e--}if(!b){for(e=0;e<a.length;e++)a[e]._count=c[a[e]._sday].max_count;for(e=
0;e<d.length;e++)d[e]._count=c[d[e]._sday].max_count}return a};scheduler._time_order=function(a){a.sort(function(a,c){return a.start_date.valueOf()==c.start_date.valueOf()?a._timed&&!c._timed?1:!a._timed&&c._timed?-1:a.id>c.id?1:-1:a.start_date>c.start_date?1:-1})};
scheduler._pre_render_events_table=function(a,b){this._time_order(a);for(var c=[],d=[[],[],[],[],[],[],[]],e=this._colsS.heights,f,g=this._cols.length,i=0;i<a.length;i++){var h=a[i];f=f||h.start_date;var k=h.end_date;if(f<this._min_date)f=this._min_date;if(k>this._max_date)k=this._max_date;var j=this.locate_holder_day(f,false,h);h._sday=j%g;k=this.locate_holder_day(k,true,h)||g;h._eday=k%g||g;h._length=k-j;h._sweek=Math.floor((this._correct_shift(f.valueOf(),1)-this._min_date.valueOf())/(864E5*g));
j=d[h._sweek];for(k=0;k<j.length;k++)if(j[k]._eday<=h._sday)break;if(!h._sorder||!b)h._sorder=k;if(h._sday+h._length<=g)f=null,c.push(h),j[k]=h,e[h._sweek]=j.length-1;else{var l=this._copy_event(h);l._length=g-h._sday;l._eday=g;l._sday=h._sday;l._sweek=h._sweek;l._sorder=h._sorder;l.end_date=this.date.add(f,l._length,"day");c.push(l);j[k]=l;f=l.end_date;e[h._sweek]=j.length-1;i--}}return c};scheduler._copy_dummy=function(){this.start_date=new Date(this.start_date);this.end_date=new Date(this.end_date)};
scheduler._copy_event=function(a){this._copy_dummy.prototype=a;return new this._copy_dummy};scheduler._rendered=[];scheduler.clear_view=function(){for(var a=0;a<this._rendered.length;a++){var b=this._rendered[a];b.parentNode&&b.parentNode.removeChild(b)}this._rendered=[]};scheduler.updateEvent=function(a){var b=this.getEvent(a);this.clear_event(a);b&&this.is_visible_events(b)&&this.render_view_data([b],true)};
scheduler.clear_event=function(a){this.for_rendered(a,function(a,c){a.parentNode&&a.parentNode.removeChild(a);scheduler._rendered.splice(c,1)})};
scheduler.render_event=function(a){var b=scheduler.xy.menu_width;if(!(a._sday<0)){var c=scheduler.locate_holder(a._sday);if(c){var d=a.start_date.getHours()*60+a.start_date.getMinutes(),e=a.end_date.getHours()*60+a.end_date.getMinutes()||scheduler.config.last_hour*60,f=Math.round((d*6E4-this.config.first_hour*36E5)*this.config.hour_size_px/36E5)%(this.config.hour_size_px*24)+1,e=Math.max(scheduler.xy.min_event_height,(e-d)*this.config.hour_size_px/60)+1,g=Math.floor((c.clientWidth-b)/a._count),d=
a._sorder*g+1;a._inner||(g*=a._count-a._sorder);if(this.config.cascade_event_display)var g=this.config.cascade_event_count,i=this.config.cascade_event_margin,d=a._sorder%g*i,g=Math.floor(c.clientWidth-b-d-(a._inner?(a._count-a._sorder-1)%g*i/2:0));i=this._render_v_bar(a.id,b+d,f,g,e,a._text_style,scheduler.templates.event_header(a.start_date,a.end_date,a),scheduler.templates.event_text(a.start_date,a.end_date,a));this._rendered.push(i);c.appendChild(i);d=d+parseInt(c.style.left,10)+b;if(this._edit_id==
a.id){i.style.zIndex=1;g=Math.max(g-4,scheduler.xy.editor_width);i=document.createElement("DIV");i.setAttribute("event_id",a.id);this.set_xy(i,g,e-20,d,f+14);i.className="dhx_cal_editor";c=document.createElement("DIV");this.set_xy(c,g-6,e-26);c.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;";i.appendChild(c);this._els.dhx_cal_data[0].appendChild(i);this._rendered.push(i);c.innerHTML="<textarea class='dhx_cal_editor'>"+a.text+"</textarea>";if(this._quirks7)c.firstChild.style.height=e-12+
"px";this._editor=c.firstChild;this._editor.onkeypress=function(a){if((a||event).shiftKey)return true;a=(a||event).keyCode;a==scheduler.keys.edit_save&&scheduler.editStop(true);a==scheduler.keys.edit_cancel&&scheduler.editStop(false)};this._editor.onselectstart=function(a){return(a||event).cancelBubble=true};c.firstChild.focus();this._els.dhx_cal_data[0].scrollLeft=0;c.firstChild.select()}if(this._select_id==a.id){if(this.config.cascade_event_display&&this._drag_mode)i.style.zIndex=1;for(var c=this.config["icons_"+
(this._edit_id==a.id?"edit":"select")],e="",g=a.color?"background-color:"+a.color+";":"",i=a.textColor?"color:"+a.textColor+";":"",h=0;h<c.length;h++)e+="<div class='dhx_menu_icon "+c[h]+"' style='"+g+""+i+"' title='"+this.locale.labels[c[h]]+"'></div>";a=this._render_v_bar(a.id,d-b+1,f,b,c.length*20+26,"","<div style='"+g+""+i+"' class='dhx_menu_head'></div>",e,true);a.style.left=d-b+1;this._els.dhx_cal_data[0].appendChild(a);this._rendered.push(a)}}}};
scheduler._render_v_bar=function(a,b,c,d,e,f,g,i,h){var k=document.createElement("DIV"),j=this.getEvent(a),l="dhx_cal_event",m=scheduler.templates.event_class(j.start_date,j.end_date,j);m&&(l=l+" "+m);m=j.color?"background-color:"+j.color+";":"";j=j.textColor?"color:"+j.textColor+";":"";a='<div event_id="'+a+'" class="'+l+'" style="position:absolute; top:'+c+"px; left:"+b+"px; width:"+(d-4)+"px; height:"+e+"px;"+(f||"")+'">';a+='<div class="dhx_header" style=" width:'+(d-6)+"px;"+m+'" >\u00a0</div>';
a+='<div class="dhx_title" style="'+m+""+j+'">'+g+"</div>";a+='<div class="dhx_body" style=" width:'+(d-(this._quirks?4:14))+"px; height:"+(e-(this._quirks?20:30))+"px;"+m+""+j+'">'+i+"</div>";a+='<div class="dhx_footer" style=" width:'+(d-8)+"px;"+(h?" margin-top:-1px;":"")+""+m+""+j+'" ></div></div>';k.innerHTML=a;return k.firstChild};scheduler.locate_holder=function(a){return this._mode=="day"?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[a]};
scheduler.locate_holder_day=function(a,b){var c=Math.floor((this._correct_shift(a,1)-this._min_date)/864E5);b&&this.date.time_part(a)&&c++;return c};
scheduler.render_event_bar=function(a){var b=this._rendered_location,c=this._colsS[a._sday],d=this._colsS[a._eday];d==c&&(d=this._colsS[a._eday+1]);var e=this._colsS.heights[a._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+a._sorder*this.xy.bar_height,f=document.createElement("DIV"),g=a._timed?"dhx_cal_event_clear":"dhx_cal_event_line",i=scheduler.templates.event_class(a.start_date,a.end_date,a);i&&(g=g+" "+i);c='<div event_id="'+a.id+'" class="'+g+'" style="position:absolute; top:'+
e+"px; left:"+c+"px; width:"+(d-c-15)+"px;"+(a.textColor?"color:"+a.textColor+";":"")+""+(a.color?"background-color:"+a.color+";":"")+""+(a._text_style||"")+'">';a._timed&&(c+=scheduler.templates.event_bar_date(a.start_date,a.end_date,a));c+=scheduler.templates.event_bar_text(a.start_date,a.end_date,a)+"</div>";c+="</div>";f.innerHTML=c;this._rendered.push(f.firstChild);b.appendChild(f.firstChild)};
scheduler._locate_event=function(a){for(var b=null;a&&!b&&a.getAttribute;)b=a.getAttribute("event_id"),a=a.parentNode;return b};scheduler.edit=function(a){if(this._edit_id!=a)this.editStop(false,a),this._edit_id=a,this.updateEvent(a)};scheduler.editStop=function(a,b){if(!(b&&this._edit_id==b)){var c=this.getEvent(this._edit_id);if(c){if(a)c.text=this._editor.value;this._editor=this._edit_id=null;this.updateEvent(c.id);this._edit_stop_event(c,a)}}};
scheduler._edit_stop_event=function(a,b){this._new_event?(b?this.callEvent("onEventAdded",[a.id,a]):this.deleteEvent(a.id,true),this._new_event=null):b&&this.callEvent("onEventChanged",[a.id,a])};scheduler.getEvents=function(a,b){var c=[],d;for(d in this._events){var e=this._events[d];e&&e.start_date<b&&e.end_date>a&&c.push(e)}return c};scheduler._loaded={};
scheduler._load=function(a,b){a=a||this._load_url;a+=(a.indexOf("?")==-1?"?":"&")+"timeshift="+(new Date).getTimezoneOffset();this.config.prevent_cache&&(a+="&uid="+this.uid());var c,b=b||this._date;if(this._load_mode){for(var d=this.templates.load_format,b=this.date[this._load_mode+"_start"](new Date(b.valueOf()));b>this._min_date;)b=this.date.add(b,-1,this._load_mode);c=b;for(var e=true;c<this._max_date;)c=this.date.add(c,1,this._load_mode),this._loaded[d(b)]&&e?b=this.date.add(b,1,this._load_mode):
e=false;e=c;do c=e,e=this.date.add(c,-1,this._load_mode);while(e>b&&this._loaded[d(e)]);if(c<=b)return false;for(dhtmlxAjax.get(a+"&from="+d(b)+"&to="+d(c),function(a){scheduler.on_load(a)});b<c;)this._loaded[d(b)]=true,b=this.date.add(b,1,this._load_mode)}else dhtmlxAjax.get(a,function(a){scheduler.on_load(a)});this.callEvent("onXLS",[]);return true};
scheduler.on_load=function(a){this._loading=true;a=this._process?this[this._process].parse(a.xmlDoc.responseText):this._magic_parser(a);this._not_render=true;for(var b=0;b<a.length;b++)this.callEvent("onEventLoading",[a[b]])&&this.addEvent(a[b]);this._not_render=false;this._render_wait&&this.render_view_data();this._loading=false;this._after_call&&this._after_call();this._after_call=null;this.callEvent("onXLE",[])};scheduler.json={};
scheduler.json.parse=function(a){if(typeof a=="string")eval("scheduler._temp = "+a+";"),a=scheduler._temp;for(var b=[],c=0;c<a.length;c++)a[c].start_date=scheduler.templates.xml_date(a[c].start_date),a[c].end_date=scheduler.templates.xml_date(a[c].end_date),b.push(a[c]);return b};scheduler.parse=function(a,b){this._process=b;this.on_load({xmlDoc:{responseText:a}})};scheduler.load=function(a,b,c){if(typeof b=="string")this._process=b,b=c;this._load_url=a;this._after_call=b;this._load(a,this._date)};
scheduler.setLoadMode=function(a){a=="all"&&(a="");this._load_mode=a};scheduler.refresh=function(){alert("not implemented")};scheduler.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]=this.serverList[a]||[]};scheduler._userdata={};
scheduler._magic_parser=function(a){var b;if(!a.getXMLTopNode){var c=a.xmlDoc.responseText,a=new dtmlXMLLoaderObject(function(){});a.loadXMLString(c)}b=a.getXMLTopNode("data");if(b.tagName!="data")return[];b=a.doXPath("//coll_options");for(c=0;c<b.length;c++){var d=this.serverList[b[c].getAttribute("for")];if(d){d.splice(0,d.length);for(var e=a.doXPath(".//item",b[c]),f=0;f<e.length;f++){for(var g=e[f].attributes,i={key:e[f].getAttribute("value"),label:e[f].getAttribute("label")},h=0;h<g.length;h++){var k=
g[h];if(!(k.nodeName=="value"||k.nodeName=="label"))i[k.nodeName]=k.nodeValue}d.push(i)}}}b.length&&scheduler.callEvent("onOptionsLoad",[]);b=a.doXPath("//userdata");for(c=0;c<b.length;c++)d=this.xmlNodeToJSON(b[c]),this._userdata[d.name]=d.text;d=[];b=a.doXPath("//event");for(c=0;c<b.length;c++)d[c]=this.xmlNodeToJSON(b[c]),d[c].text=d[c].text||d[c]._tagvalue,d[c].start_date=this.templates.xml_date(d[c].start_date),d[c].end_date=this.templates.xml_date(d[c].end_date);return d};
scheduler.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];d.nodeType==1&&(b[d.tagName]=d.firstChild?d.firstChild.nodeValue:"")}if(!b.text)b.text=a.firstChild?a.firstChild.nodeValue:"";return b};
scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===true){var a;a=this.config.show_loading=document.createElement("DIV");a.className="dhx_loading";a.style.left=Math.round((this._x-128)/2)+"px";a.style.top=Math.round((this._y-15)/2)+"px";this._obj.appendChild(a)}});scheduler.attachEvent("onXLE",function(){var a;if((a=this.config.show_loading)&&typeof a=="object")this._obj.removeChild(a),this.config.show_loading=true});
scheduler.ical={parse:function(a){a=a.match(RegExp(this.c_start+"[^\u000c]*"+this.c_end,""));if(a.length){a[0]=a[0].replace(/[\r\n]+(?=[a-z \t])/g," ");a[0]=a[0].replace(/\;[^:\r\n]*/g,"");for(var b=[],c,d=RegExp("(?:"+this.e_start+")([^\u000c]*?)(?:"+this.e_end+")","g");c=d.exec(a);){for(var e={},f,g=/[^\r\n]+[\r\n]+/g;f=g.exec(c[1]);)this.parse_param(f.toString(),e);if(e.uid&&!e.id)e.id=e.uid;b.push(e)}return b}},parse_param:function(a,b){var c=a.indexOf(":");if(c!=-1){var d=a.substr(0,c).toLowerCase(),
c=a.substr(c+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");d=="summary"?d="text":d=="dtstart"?(d="start_date",c=this.parse_date(c,0,0)):d=="dtend"&&(d="end_date",c=b.start_date&&b.start_date.getHours()==0?this.parse_date(c,24,0):this.parse_date(c,23,59));b[d]=c}},parse_date:function(a,b,c){a=a.split("T");a[1]&&(b=a[1].substr(0,2),c=a[1].substr(2,2));var d=a[0].substr(0,4),e=parseInt(a[0].substr(4,2),10)-1,f=a[0].substr(6,2);return scheduler.config.server_utc&&!a[1]?new Date(Date.UTC(d,e,f,b,c)):
new Date(d,e,f,b,c)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"};scheduler.formSection=function(a){for(var b=this.config.lightbox.sections,c=0;c<b.length;c++)if(b[c].name==a)break;var d=b[c],e=document.getElementById(d.id).nextSibling;return{getValue:function(a){return scheduler.form_blocks[d.type].get_value(e,a||{},d)},setValue:function(a,b){return scheduler.form_blocks[d.type].set_value(e,a,b||{},d)}}};
scheduler.form_blocks={template:{render:function(a){return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+((a.height||"30")+"px")+";'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){return"<div class='dhx_cal_ltext' style='height:"+((a.height||"130")+"px")+";'><textarea></textarea></div>"},set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},
focus:function(a){a=a.firstChild;a.select();a.focus()}},select:{render:function(a){for(var b="<div class='dhx_cal_ltext' style='height:"+((a.height||"23")+"px")+";'><select style='width:100%;'>",c=0;c<a.options.length;c++)b+="<option value='"+a.options[c].key+"'>"+a.options[c].label+"</option>";b+="</select></div>";return b},set_value:function(a,b){if(typeof b=="undefined")b=(a.firstChild.options[0]||{}).value;a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){a=
a.firstChild;a.select&&a.select();a.focus()}},time:{render:function(){var a=scheduler.config,b=this.date.date_part(new Date),c=1440,d=0;scheduler.config.limit_time_select&&(c=60*a.last_hour+1,d=60*a.first_hour,b.setHours(a.first_hour));for(var a="<select>",e=b.getDate();d<c;){var f=this.templates.time_picker(b);a+="<option value='"+d+"'>"+f+"</option>";b.setTime(b.valueOf()+this.config.time_step*6E4);d=(b.getDate()!=e?1:0)*1440+b.getHours()*60+b.getMinutes()}a+="</select> <select>";for(d=1;d<32;d++)a+=
"<option value='"+d+"'>"+d+"</option>";a+="</select> <select>";for(d=0;d<12;d++)a+="<option value='"+d+"'>"+this.locale.date.month_full[d]+"</option>";a+="</select> <select>";b=b.getFullYear()-5;for(d=0;d<10;d++)a+="<option value='"+(b+d)+"'>"+(b+d)+"</option>";a+="</select> ";return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+a+"<span style='font-weight:normal; font-size:10pt;'> \u00a0\u2013\u00a0 </span>"+a+"</div>"},set_value:function(a,b,c){function d(a,
b,c){a[b+0].value=Math.round((c.getHours()*60+c.getMinutes())/scheduler.config.time_step)*scheduler.config.time_step;a[b+1].value=c.getDate();a[b+2].value=c.getMonth();a[b+3].value=c.getFullYear()}var e=a.getElementsByTagName("select");if(scheduler.config.full_day){if(!a._full_day)b="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"\u00a0</label></input>",scheduler.config.wide_form||(b=a.previousSibling.innerHTML+b),a.previousSibling.innerHTML=
b,a._full_day=true;var f=a.previousSibling.getElementsByTagName("input")[0],a=scheduler.date.time_part(c.start_date)===0&&scheduler.date.time_part(c.end_date)===0&&c.end_date.valueOf()-c.start_date.valueOf()<1728E5;f.checked=a;for(var g in e)e[g].disabled=f.checked;f.onclick=function(){if(f.checked){var a=new Date(c.start_date),b=new Date(c.end_date);scheduler.date.date_part(a);b=scheduler.date.add(a,1,"day")}for(var g in e)e[g].disabled=f.checked;d(e,0,a||c.start_date);d(e,4,b||c.end_date)}}if(scheduler.config.auto_end_date&&
scheduler.config.event_duration){g=function(){c.start_date=new Date(e[3].value,e[2].value,e[1].value,0,e[0].value);c.end_date.setTime(c.start_date.getTime()+scheduler.config.event_duration*6E4);d(e,4,c.end_date)};for(a=0;a<4;a++)e[a].onchange=g}d(e,0,c.start_date);d(e,4,c.end_date)},get_value:function(a,b){s=a.getElementsByTagName("select");b.start_date=new Date(s[3].value,s[2].value,s[1].value,0,s[0].value);b.end_date=new Date(s[7].value,s[6].value,s[5].value,0,s[4].value);if(b.end_date<=b.start_date)b.end_date=
scheduler.date.add(b.start_date,scheduler.config.time_step,"minute")},focus:function(a){a.getElementsByTagName("select")[0].focus()}}};
scheduler.showCover=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px";a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-
a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}this.show_cover()};scheduler.showLightbox=function(a){if(a&&this.callEvent("onBeforeLightbox",[a])){var b=this._get_lightbox();this.showCover(b);this._fill_lightbox(a,b);this.callEvent("onLightbox",[a])}};
scheduler._fill_lightbox=function(a,b){var c=this.getEvent(a),d=b.getElementsByTagName("span");scheduler.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=scheduler.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.event_header(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.event_bar_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var d=this.config.lightbox.sections,e=0;e<d.length;e++){var f=document.getElementById(d[e].id).nextSibling,
g=this.form_blocks[d[e].type];g.set_value.call(this,f,c[d[e].map_to],c,d[e]);d[e].focus&&g.focus.call(this,f)}scheduler._lightbox_id=a};scheduler._lightbox_out=function(a){for(var b=this.config.lightbox.sections,c=0;c<b.length;c++){var d=document.getElementById(b[c].id),d=d?d.nextSibling:d,d=this.form_blocks[b[c].type].get_value.call(this,d,a,b[c]);b[c].map_to!="auto"&&(a[b[c].map_to]=d)}return a};
scheduler._empty_lightbox=function(){var a=this.getEvent(scheduler._lightbox_id);this._get_lightbox();this._lightbox_out(a);a._timed=this.is_one_day_event(a);this.setEvent(a.id,a);this._edit_stop_event(a,true);this.render_view_data()};scheduler.hide_lightbox=function(){this.hideCover(this._get_lightbox());this._lightbox_id=null;this.callEvent("onAfterLightbox",[])};scheduler.hideCover=function(a){if(a)a.style.display="none";this.hide_cover()};
scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover);this._cover=null};scheduler.show_cover=function(){this._cover=document.createElement("DIV");this._cover.className="dhx_cal_cover";this._cover.style.height=Math.max(document.height!==void 0?document.height:document.body.offsetHeight,document.documentElement?document.documentElement.scrollHeight:0)+"px";document.body.appendChild(this._cover)};
scheduler.save_lightbox=function(){if(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,this._lightbox_out({id:this._lightbox_id}),this._new_event]))this._empty_lightbox(),this.hide_lightbox()};scheduler.startLightbox=function(a,b){this._lightbox_id=a;this.showCover(b)};scheduler.endLightbox=function(a,b){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),a);a&&scheduler.render_view_data();this.hideCover(b)};
scheduler.resetLightbox=function(){scheduler._lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox);scheduler._lightbox=null};scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]);this.endLightbox(false);this.hide_lightbox()};
scheduler._init_lightbox_events=function(){this._get_lightbox().onclick=function(a){var b=a?a.target:event.srcElement;if(!b.className)b=b.previousSibling;if(b&&b.className)switch(b.className){case "dhx_save_btn":scheduler.save_lightbox();break;case "dhx_delete_btn":b=scheduler.locale.labels.confirm_deleting;if(!b||confirm(b))scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox();break;case "dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(b.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",
[b.className,b,a]);else if(b.className.indexOf("dhx_custom_button_")!=-1){var a=b.parentNode.getAttribute("index"),c=b.parentNode.parentNode;scheduler.form_blocks[scheduler.config.lightbox.sections[a].type].button_click(a,b,c,c.nextSibling)}}};this._get_lightbox().onkeydown=function(a){switch((a||event).keyCode){case scheduler.keys.edit_save:if((a||event).shiftKey)break;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}};
scheduler.setLightboxSize=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px";b.style.height=b.scrollHeight+"px";a.style.height=b.scrollHeight+50+"px";b.style.height=b.scrollHeight+"px"}};scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd);dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd);scheduler._init_dnd_events=function(){}};
scheduler._move_while_dnd=function(a){if(scheduler._dnd_start_lb){if(!document.dhx_unselectable)document.body.className+=" dhx_unselectable",document.dhx_unselectable=true;var b=scheduler._get_lightbox(),a=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=scheduler._lb_start[1]+a[1]-scheduler._dnd_start_lb[1]+"px";b.style.left=scheduler._lb_start[0]+a[0]-scheduler._dnd_start_lb[0]+"px"}};
scheduler._ready_to_dnd=function(a){var b=scheduler._get_lightbox();scheduler._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)];scheduler._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]};scheduler._finish_dnd=function(){if(scheduler._lb_start)scheduler._lb_start=scheduler._dnd_start_lb=false,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=false};
scheduler._get_lightbox=function(){if(!this._lightbox){var a=document.createElement("DIV");a.className="dhx_cal_light";scheduler.config.wide_form&&(a.className+=" dhx_cal_light_wide");scheduler.form_blocks.recurring&&(a.className+=" dhx_cal_light_rec");/msie|MSIE 6/.test(navigator.userAgent)&&(a.className+=" dhx_ie6");a.style.visibility="hidden";var b=this._lightbox_template,c=this.config.buttons_left;scheduler.locale.labels.dhx_save_btn=scheduler.locale.labels.icon_save;scheduler.locale.labels.dhx_cancel_btn=
scheduler.locale.labels.icon_cancel;scheduler.locale.labels.dhx_delete_btn=scheduler.locale.labels.icon_delete;for(var d=0;d<c.length;d++)b+="<div class='dhx_btn_set'><div dhx_button='1' class='"+c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";c=this.config.buttons_right;for(d=0;d<c.length;d++)b+="<div class='dhx_btn_set' style='float:right;'><div dhx_button='1' class='"+c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";b+="</div>";a.innerHTML=b;if(scheduler.config.drag_lightbox)a.firstChild.onmousedown=
scheduler._ready_to_dnd,a.firstChild.onselectstart=function(){return false},a.firstChild.style.cursor="pointer",scheduler._init_dnd_events();document.body.insertBefore(a,document.body.firstChild);this._lightbox=a;c=this.config.lightbox.sections;b="";for(d=0;d<c.length;d++){var e=this.form_blocks[c[d].type];if(e){c[d].id="area_"+this.uid();var f="";c[d].button&&(f="<div class='dhx_custom_button' index='"+d+"'><div class='dhx_custom_button_"+c[d].button+"'></div><div>"+this.locale.labels["button_"+
c[d].button]+"</div></div>");this.config.wide_form&&(b+="<div class='dhx_wrap_section'>");b+="<div id='"+c[d].id+"' class='dhx_cal_lsection'>"+f+this.locale.labels["section_"+c[d].name]+"</div>"+e.render.call(this,c[d]);b+="</div>"}}a.getElementsByTagName("div")[1].innerHTML=b;this.setLightboxSize();this._init_lightbox_events(this);a.style.display="none";a.style.visibility="visible"}return this._lightbox};scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>\u00a0</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>";
scheduler._dp_init=function(a){a._methods=["setEventTextStyle","","changeEventId","deleteEvent"];this.attachEvent("onEventAdded",function(b){!this._loading&&this.validId(b)&&a.setUpdated(b,true,"inserted")});this.attachEvent("onConfirmedBeforeEventDelete",function(b){if(this.validId(b)){var c=a.getState(b);if(c=="inserted"||this._new_event)return a.setUpdated(b,false),true;if(c=="deleted")return false;if(c=="true_deleted")return true;a.setUpdated(b,true,"deleted");return false}});this.attachEvent("onEventChanged",
function(b){!this._loading&&this.validId(b)&&a.setUpdated(b,true,"updated")});a._getRowData=function(a){var a=this.obj.getEvent(a),c={},d;for(d in a)d.indexOf("_")!=0&&(c[d]=a[d]&&a[d].getUTCFullYear?this.obj.templates.xml_format(a[d]):a[d]);return c};a._clearUpdateFlag=function(){};a.attachEvent("insertCallback",scheduler._update_callback);a.attachEvent("updateCallback",scheduler._update_callback);a.attachEvent("deleteCallback",function(a,c){this.obj.setUserData(c,this.action_param,"true_deleted");
this.obj.deleteEvent(c)})};scheduler.setUserData=function(a,b,c){a?this.getEvent(a)[b]=c:this._userdata[b]=c};scheduler.getUserData=function(a,b){return a?this.getEvent(a)[b]:this._userdata[b]};scheduler.setEventTextStyle=function(a,b){this.for_rendered(a,function(a){a.style.cssText+=";"+b});var c=this.getEvent(a);c._text_style=b;this.event_updated(c)};scheduler.validId=function(){return true};
scheduler._update_callback=function(a){a=scheduler.xmlNodeToJSON(a.firstChild);a.text=a.text||a._tagvalue;a.start_date=scheduler.templates.xml_date(a.start_date);a.end_date=scheduler.templates.xml_date(a.end_date);scheduler.addEvent(a)};
(function(){function a(a){a=a||event;for(a=a.target?a.target:a.srcElement;a&&a.tagName!="DIV";)a=a.parentNode;if(a&&a.tagName=="DIV"&&a.className.split(" ")[0]=="dhx_scale_bar"){var b;a:{b=a.parentNode.childNodes;for(var c=0;c<b.length;c++)if(b[c]==a){b=c;break a}b=-1}return{x:b,y:-1,src:a,scale:true}}}function b(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(a){var b=scheduler.matrix[scheduler._mode];if(b&&(a=scheduler._locate_cell_timeline(a)))return c(b,a,getOffset(a.src));d()});
b=function(){}}function c(a,b,c){if(a.render=="cell"){var e=b.x+"_"+b.y,f=a._matrix[b.y][b.x];if(!f)return d();f.sort(function(a,b){return a.start_date>b.start_date?1:-1});if(scheduler._tooltip){if(scheduler._tooltip.date==e)return;scheduler._tooltip.innerHTML=""}else{var h=scheduler._tooltip=document.createElement("DIV");h.className="dhx_tooltip";document.body.appendChild(h);h.onclick=scheduler._click.dhx_cal_data}for(var h="",g=0;g<f.length;g++)h+="<div class='dhx_tooltip_line' event_id='"+f[g].id+
"' style='"+(f[g].color?"background-color:"+f[g].color+";":"")+""+(f[g].textColor?"color:"+f[g].textColor+";":"")+"'>",h+="<div class='dhx_tooltip_date'>"+(f[g]._timed?scheduler.templates.event_date(f[g].start_date):"")+"</div>",h+="<div class='dhx_event_icon icon_details'>\u00a0</div>",h+=scheduler.templates[a.name+"_tooltip"](f[g].start_date,f[g].end_date,f[g])+"</div>";scheduler._tooltip.style.display="";scheduler._tooltip.style.top="0px";scheduler._tooltip.style.left=document.body.offsetWidth-
c.left-scheduler._tooltip.offsetWidth<0?c.left-scheduler._tooltip.offsetWidth+"px":c.left+b.src.offsetWidth+"px";scheduler._tooltip.date=e;scheduler._tooltip.innerHTML=h;scheduler._tooltip.style.top=document.body.offsetHeight-c.top-scheduler._tooltip.offsetHeight<0?c.top-scheduler._tooltip.offsetHeight+b.src.offsetHeight+"px":c.top+"px"}}function d(){if(scheduler._tooltip)scheduler._tooltip.style.display="none",scheduler._tooltip.date=""}function e(a){if(a)scheduler.set_sizes(),b(),a=scheduler._min_date,
g.call(this,scheduler._els.dhx_cal_header[0]),i.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=a,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler._table_view=true}function f(a,b,c){switch(a){case "day":return!(b.getDate()==c.getDate()&&b.getMonth()==c.getMonth()&&b.getFullYear()==c.getFullYear());case "week":return!(scheduler.date.getISOWeek(b)==scheduler.date.getISOWeek(c)&&b.getFullYear()==c.getFullYear());
case "month":return!(b.getMonth()==c.getMonth()&&b.getFullYear()==c.getFullYear());case "year":return b.getFullYear()!=c.getFullYear();default:return false}}function g(b){var c=scheduler.xy.scale_height,d=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[];scheduler._colsS={height:0};this._trace_x=[];var e=scheduler._x-this.dx-18,h=[this.dx];scheduler._els.dhx_cal_header[0].style.width=h[0]+e+"px";for(var g=scheduler._min_date_timeline=scheduler._min_date,i=0;i<this.x_size;i++)this._trace_x[i]=
new Date(g),g=scheduler.date.add(g,this.x_step,this.x_unit),scheduler._cols[i]=Math.floor(e/(this.x_size-i)),e-=scheduler._cols[i],h[i+1]=h[i]+scheduler._cols[i];b.innerHTML="<div></div>";if(this.second_scale){for(var k=this.second_scale.x_unit,g=[this._trace_x[0]],e=[],i=[this.dx,this.dx],j=0,p=0;p<this._trace_x.length;p++){var n=this._trace_x[p];f(k,n,g[j])&&(++j,g[j]=n,i[j+1]=i[j]);n=j+1;e[j]=scheduler._cols[p]+(e[j]||0);i[n]+=scheduler._cols[p]}b.innerHTML="<div></div><div></div>";k=b.firstChild;
k.style.height=d+"px";b.lastChild.style.position="relative";for(j=0;j<g.length;j++){var p=g[j],n=scheduler.templates[this.name+"_second_scalex_class"](p),q=document.createElement("DIV");q.className="dhx_scale_bar dhx_second_scale_bar"+(n?" "+n:"");scheduler.set_xy(q,e[j]-1,d-3,i[j],0);q.innerHTML=scheduler.templates[this.name+"_second_scale_date"](p);k.appendChild(q)}}scheduler.xy.scale_height=d;b=b.lastChild;for(d=0;d<this._trace_x.length;d++)g=this._trace_x[d],scheduler._render_x_header(d,h[d],
g,b),(g=scheduler.templates[this.name+"_scalex_class"](g))&&(b.lastChild.className+=" "+g);scheduler.xy.scale_height=c;var F=this._trace_x;b.onclick=function(b){var c=a(b);c&&scheduler.callEvent("onXScaleClick",[c.x,F[c.x],b||event])};b.ondblclick=function(b){var c=a(b);c&&scheduler.callEvent("onXScaleDblClick",[c.x,F[c.x],b||event])}}function i(a){var b="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",c=[];scheduler._load_mode&&scheduler._load();if(this.render=="cell")c=k.call(this);
else for(var d=scheduler.get_visible_events(),e=0;e<d.length;e++){var f=this.order[d[e][this.y_property]];c[f]||(c[f]=[]);c[f].push(d[e])}for(f=d=0;f<scheduler._cols.length;f++)d+=scheduler._cols[f];e=new Date;this._step=e=(scheduler.date.add(e,this.x_step*this.x_size,this.x_unit)-e)/d;this._summ=d;var h=scheduler._colsS.heights=[];this._events_height={};for(f=0;f<this.y_unit.length;f++){var g=this._logic(this.render,this.y_unit[f],this);scheduler._merge(g,{height:this.dy});if(this.section_autoheight&&
this.y_unit.length*g.height<a.offsetHeight)g.height=Math.max(g.height,Math.floor((a.offsetHeight-1)/this.y_unit.length));scheduler._merge(g,{tr_className:"",style_height:"height:"+g.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this)?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this):""),td_content:scheduler.templates[this.name+
"_scale_label"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f]),summ_width:"width:"+d+"px;",table_className:""});var i="";if(c[f]&&this.render!="cell"){c[f].sort(function(a,b){return a.start_date>b.start_date?1:-1});for(var j=[],e=0;e<c[f].length;e++){for(var n=c[f][e],q=0;j[q]&&j[q].end_date>n.start_date;)q++;j[q]=n;i+=scheduler.render_timeline_event.call(this,n,q)}}if(this.fit_events)e=this._events_height[this.y_unit[f].key]||0,g.height=e>g.height?e:g.height,g.style_height="height:"+g.height+
"px;";b+="<tr class='"+g.tr_className+"' style='"+g.style_height+"'><td class='"+g.td_className+"' style='"+g.style_width+" height:"+(g.height-1)+"px;'>"+g.td_content+"</td>";if(this.render=="cell")for(e=0;e<scheduler._cols.length;e++)b+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](c[f][e],this._trace_x[e],this.y_unit[f])+"' style='width:"+(scheduler._cols[e]-1)+"px'><div style='width:"+(scheduler._cols[e]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](c[f][e])+
"</div></td>";else{b+="<td><div style='"+g.summ_width+" "+g.style_height+" position:relative;' class='dhx_matrix_line'>";b+=i;b+="<table class='"+g.table_className+"' cellpadding='0' cellspacing='0' style='"+g.summ_width+" "+g.style_height+"' >";for(e=0;e<scheduler._cols.length;e++)b+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](c[f],this._trace_x[e],this.y_unit[f])+"' style='width:"+(scheduler._cols[e]-1)+"px'><div style='width:"+(scheduler._cols[e]-1)+"px'></div></td>";
b+="</table>";b+="</div></td>"}b+="</tr>"}b+="</table>";this._matrix=c;a.innerHTML=b;scheduler._rendered=[];b=document.getElementsByTagName("DIV");for(f=0;f<b.length;f++)b[f].getAttribute("event_id")&&scheduler._rendered.push(b[f]);for(f=0;f<a.firstChild.rows.length;f++)h.push(a.firstChild.rows[f].offsetHeight)}function h(a,b,c){var d=0,a=b?a.end_date:a.start_date;if(a.valueOf()>scheduler._max_date.valueOf())a=scheduler._max_date;var e=a-scheduler._min_date_timeline;if(e<0)c=0;else{e=Math.round(e/
(c*scheduler._cols[0]));if(e>scheduler._cols.length)e=scheduler._cols.length;for(var f=0;f<e;f++)d+=scheduler._cols[f];e=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*e,scheduler.matrix[scheduler._mode].x_unit);c=Math.floor((a-e)/c)}d+=b?c-14:c+1;return d}function k(){for(var a=scheduler.get_visible_events(),b=[],c=0;c<this.y_unit.length;c++)b[c]=[];b[d]||(b[d]=[]);for(c=0;c<a.length;c++){for(var d=this.order[a[c][this.y_property]],e=0;this._trace_x[e+1]&&
a[c].start_date>=this._trace_x[e+1];)e++;for(;this._trace_x[e]&&a[c].end_date>this._trace_x[e];)b[d][e]||(b[d][e]=[]),b[d][e].push(a[c]),e++}return b}scheduler.matrix={};scheduler._merge=function(a,b){for(var c in b)typeof a[c]=="undefined"&&(a[c]=b[c])};scheduler.createTimelineView=function(a){scheduler._merge(a,{section_autoheight:true,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,fit_events:true,second_scale:false,
_logic:function(a,b,c){var d={};scheduler.checkEvent("onBeforeViewRender")&&(d=scheduler.callEvent("onBeforeViewRender",[a,b,c]));return d}});scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[a]);var b=scheduler.render_data;scheduler.render_data=function(c,d){if(this._mode==a.name)if(d)for(var f=0;f<c.length;f++)this.clear_event(c[f]),this.render_timeline_event.call(this.matrix[this._mode],c[f],0,true);else e.call(a,true);else return b.apply(this,arguments)};scheduler.matrix[a.name]=
a;scheduler.templates[a.name+"_cell_value"]=function(a){return a?a.length:""};scheduler.templates[a.name+"_cell_class"]=function(){return""};scheduler.templates[a.name+"_scalex_class"]=function(){return""};scheduler.templates[a.name+"_second_scalex_class"]=function(){return""};scheduler.templates[a.name+"_scaley_class"]=function(){return""};scheduler.templates[a.name+"_scale_label"]=function(a,b){return b};scheduler.templates[a.name+"_tooltip"]=function(a,b,c){return c.text};scheduler.templates[a.name+
"_date"]=function(a,b){return a.getDay()==b.getDay()&&b-a<864E5?scheduler.templates.day_date(a):scheduler.templates.week_date(a,b)};scheduler.templates[a.name+"_scale_date"]=scheduler.date.date_to_str(a.x_date||scheduler.config.hour_date);scheduler.templates[a.name+"_second_scale_date"]=scheduler.date.date_to_str(a.second_scale&&a.second_scale.x_date?a.second_scale.x_date:scheduler.config.hour_date);scheduler.date["add_"+a.name]=function(b,c){return scheduler.date.add(b,(a.x_length||a.x_size)*c*a.x_step,
a.x_unit)};scheduler.date[a.name+"_start"]=scheduler.date[a.x_unit+"_start"]||scheduler.date.day_start;scheduler.attachEvent("onSchedulerResize",function(){return this._mode==a.name?(e.call(a,true),false):true});scheduler.attachEvent("onOptionsLoad",function(){a.order={};scheduler.callEvent("onOptionsLoadStart",[]);for(var b=0;b<a.y_unit.length;b++)a.order[a.y_unit[b].key]=b;scheduler.callEvent("onOptionsLoadFinal",[]);scheduler._date&&a.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,
scheduler._mode)});scheduler.callEvent("onOptionsLoad",[a]);scheduler[a.name+"_view"]=function(){scheduler.renderMatrix.apply(a,arguments)};if(a.render!="cell"){var c=new Date,d=scheduler.date.add(c,a.x_step,a.x_unit).valueOf()-c.valueOf();scheduler["mouse_"+a.name]=function(b){var c=this._drag_event;if(this._drag_id)c=this.getEvent(this._drag_id),this._drag_event._dhx_changed=true;b.x-=a.dx;for(var e=0,f=0,g=0;f<this._cols.length-1;f++)if(e+=this._cols[f],e>b.x)break;for(e=0;g<this._colsS.heights.length;g++)if(e+=
this._colsS.heights[g],e>b.y)break;b.fields={};a.y_unit[g]||(g=a.y_unit.length-1);b.fields[a.y_property]=c[a.y_property]=a.y_unit[g].key;b.x=0;this._drag_mode=="new-size"&&c.start_date*1==this._drag_start*1&&f++;c=f>=a._trace_x.length?scheduler.date.add(a._trace_x[a._trace_x.length-1],a.x_step,a.x_unit):a._trace_x[f];b.y=Math.round((c-this._min_date)/(6E4*this.config.time_step));b.custom=true;b.shift=d;return b}}};scheduler.render_timeline_event=function(a,b,c){var d=h(a,false,this._step),e=h(a,true,
this._step),f=scheduler.xy.bar_height,b=2+b*f,g=f+b-2,f=a[this.y_property];if(!this._events_height[f]||this._events_height[f]<g)this._events_height[f]=g;g=scheduler.templates.event_class(a.start_date,a.end_date,a);a='<div event_id="'+a.id+'" class="'+("dhx_cal_event_line "+(g||""))+'" style="'+(a.color?"background-color:"+a.color+";":"")+""+(a.textColor?"color:"+a.textColor+";":"")+"position:absolute; top:"+b+"px; left:"+d+"px; width:"+Math.max(0,e-d)+"px;"+(a._text_style||"")+'">'+scheduler.templates.event_bar_text(a.start_date,
a.end_date,a)+"</div>";if(c)c=document.createElement("DIV"),c.innerHTML=a,a=scheduler._els.dhx_cal_data[0].firstChild.rows[this.order[f]].cells[1].firstChild,scheduler._rendered.push(c.firstChild),a.appendChild(c.firstChild);else return a};scheduler.renderMatrix=function(a){scheduler._els.dhx_cal_data[0].scrollTop=0;var b=scheduler.date[this.name+"_start"](scheduler._date);scheduler._min_date=scheduler.date.add(b,this.x_start*this.x_step,this.x_unit);scheduler._max_date=scheduler.date.add(scheduler._min_date,
this.x_size*this.x_step,this.x_unit);scheduler._table_view=true;if(this.second_scale){if(a&&!this._header_resized)this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header";if(!a&&this._header_resized)scheduler.xy.scale_height/=2,this._header_resized=false,b=scheduler._els.dhx_cal_header[0],b.className=b.className.replace(/ dhx_second_cal_header/gi,"")}e.call(this,a)};scheduler._locate_cell_timeline=function(a){a=
a||event;for(a=a.target?a.target:a.srcElement;a&&a.tagName!="TD";)a=a.parentNode;if(a&&a.tagName=="TD"){var b=a.className.split(" ")[0];if(b=="dhx_matrix_cell")if(scheduler._isRender("cell"))return{x:a.cellIndex-1,y:a.parentNode.rowIndex,src:a};else{for(b=a.parentNode;b&&b.tagName!="TD";)b=b.parentNode;return{x:a.cellIndex,y:b.parentNode.rowIndex,src:a}}else if(b=="dhx_matrix_scell")return{x:-1,y:a.parentNode.rowIndex,src:a,scale:true}}return false};var j=scheduler._click.dhx_cal_data;scheduler._click.dhx_cal_data=
function(a){var b=j.apply(this,arguments),c=scheduler.matrix[scheduler._mode];if(c){var d=scheduler._locate_cell_timeline(a);d&&(d.scale?scheduler.callEvent("onYScaleClick",[d.y,c.y_unit[d.y],a||event]):scheduler.callEvent("onCellClick",[d.x,d.y,c._trace_x[d.x],(c._matrix[d.y]||{})[d.x]||[],a||event]))}return b};scheduler.dblclick_dhx_matrix_cell=function(a){var b=scheduler.matrix[scheduler._mode];if(b){var c=scheduler._locate_cell_timeline(a);c&&(c.scale?scheduler.callEvent("onYScaleDblClick",[c.y,
b.y_unit[c.y],a||event]):scheduler.callEvent("onCellDblClick",[c.x,c.y,b._trace_x[c.x],(b._matrix[c.y]||{})[c.x]||[],a||event]))}};scheduler.dblclick_dhx_matrix_scell=function(a){return scheduler.dblclick_dhx_matrix_cell(a)};scheduler._isRender=function(a){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==a};scheduler.attachEvent("onCellDblClick",function(a,b,c,d,e){if(!(this.config.readonly||e.type=="dblclick"&&!this.config.dblclick_create))c=scheduler.matrix[scheduler._mode],
d={},d.start_date=c._trace_x[a],d.end_date=c._trace_x[a+1]?c._trace_x[a+1]:scheduler.date.add(c._trace_x[a],c.x_step,c.x_unit),d[scheduler.matrix[scheduler._mode].y_property]=c.y_unit[b].key,scheduler.addEventNow(d,null,e)});scheduler.attachEvent("onBeforeDrag",function(){return scheduler._isRender("cell")?false:true})})();scheduler.date.add_agenda=function(a){return new Date(a.valueOf())};scheduler.dblclick_dhx_agenda_area=function(){!this.config.readonly&&this.config.dblclick_create&&this.addEventNow()};
scheduler.templates.agenda_time=function(a,b,c){return c._timed?this.day_date(c.start_date,c.end_date,c)+" "+this.event_date(a):scheduler.templates.day_date(a)+" \u2013 "+scheduler.templates.day_date(b)};scheduler.templates.agenda_text=function(a,b,c){return c.text};scheduler.date.agenda_start=function(a){return a};
scheduler.attachEvent("onTemplatesReady",function(){function a(){var a=scheduler.get_visible_events();a.sort(function(a,b){return a.start_date>b.start_date?1:-1});for(var b="<div class='dhx_agenda_area'>",c=0;c<a.length;c++){var g=a[c];b+="<div class='dhx_agenda_line' event_id='"+g.id+"' style='"+(g.textColor?"color:"+g.textColor+";":"")+""+(g.color?"background-color:"+g.color+";":"")+""+(g._text_style||"")+"'><div>"+scheduler.templates.agenda_time(g.start_date,g.end_date,g)+"</div>";b+="<div class='dhx_event_icon icon_details'>&nbsp</div>";
b+="<span>"+scheduler.templates.agenda_text(g.start_date,g.end_date,g)+"</span></div>"}b+="<div class='dhx_v_border'></div></div>";scheduler._els.dhx_cal_data[0].innerHTML=b;scheduler._els.dhx_cal_data[0].childNodes[0].scrollTop=scheduler._agendaScrollTop||0;a=scheduler._els.dhx_cal_data[0].firstChild.childNodes;scheduler._els.dhx_cal_date[0].innerHTML="";scheduler._rendered=[];for(c=0;c<a.length-1;c++)scheduler._rendered[c]=a[c]}scheduler.attachEvent("onSchedulerResize",function(){return this._mode==
"agenda"?(this.agenda_view(true),false):true});var b=scheduler.render_data;scheduler.render_data=function(c){if(this._mode=="agenda")a();else return b.apply(this,arguments)};var c=scheduler.render_view_data;scheduler.render_view_data=function(){this._mode=="agenda"?(scheduler._agendaScrollTop=scheduler._els.dhx_cal_data[0].childNodes[0].scrollTop,scheduler._els.dhx_cal_data[0].childNodes[0].scrollTop=0,scheduler._els.dhx_cal_data[0].style.overflowY="hidden"):scheduler._els.dhx_cal_data[0].style.overflowY=
"auto";return c.apply(this,arguments)};scheduler.agenda_view=function(b){scheduler._min_date=scheduler.config.agenda_start||new Date;scheduler._max_date=scheduler.config.agenda_end||new Date(9999,1,1);scheduler._table_view=true;if(b){var c=scheduler.locale.labels;scheduler._els.dhx_cal_header[0].innerHTML="<div class='dhx_agenda_line'><div>"+c.date+"</div><span style='padding-left:25px'>"+c.description+"</span></div>";scheduler._table_view=true;scheduler.set_sizes()}b&&a()}});
scheduler.config.year_x=4;scheduler.config.year_y=3;scheduler.config.year_mode_name="year";scheduler.xy.year_top=0;scheduler.templates.year_date=function(a){return scheduler.date.date_to_str(scheduler.locale.labels.year_tab+" %Y")(a)};scheduler.templates.year_month=scheduler.date.date_to_str("%F");scheduler.templates.year_scale_date=scheduler.date.date_to_str("%D");scheduler.templates.year_tooltip=function(a,b,c){return c.text};
(function(){var a=function(){return scheduler._mode==scheduler.config.year_mode_name};scheduler.dblclick_dhx_month_head=function(b){if(a()){var c=b.target||b.srcElement;if(c.parentNode.className.indexOf("dhx_before")!=-1||c.parentNode.className.indexOf("dhx_after")!=-1)return false;var d=this.templates.xml_date(c.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("date"));d.setDate(parseInt(c.innerHTML,10));c=this.date.add(d,1,"day");!this.config.readonly&&this.config.dblclick_create&&
this.addEventNow(d.valueOf(),c.valueOf(),b)}};var b=scheduler.changeEventId;scheduler.changeEventId=function(){b.apply(this,arguments);a()&&this.year_view(true)};var c=scheduler.render_data,d=scheduler.date.date_to_str("%Y/%m/%d"),e=scheduler.date.str_to_date("%Y/%m/%d");scheduler.render_data=function(b){if(!a())return c.apply(this,arguments);for(var d=0;d<b.length;d++)this._year_render_event(b[d])};var f=scheduler.clear_view;scheduler.clear_view=function(){if(!a())return f.apply(this,arguments);
for(var b=0;b<g.length;b++)g[b].className="dhx_month_head",g[b].setAttribute("date","");g=[]};scheduler.hideToolTip=function(){if(this._tooltip)this._tooltip.style.display="none",this._tooltip.date=new Date(9999,1,1)};scheduler.showToolTip=function(a,b,c,d){if(this._tooltip){if(this._tooltip.date.valueOf()==a.valueOf())return;this._tooltip.innerHTML=""}else c=this._tooltip=document.createElement("DIV"),c.className="dhx_tooltip",document.body.appendChild(c),c.onclick=scheduler._click.dhx_cal_data;
for(var c=this.getEvents(a,this.date.add(a,1,"day")),e="",f=0;f<c.length;f++){var g=c[f],o=g.color?"background-color:"+g.color+";":"",g=g.textColor?"color:"+g.textColor+";":"";e+="<div class='dhx_tooltip_line' style='"+o+""+g+"' event_id='"+c[f].id+"'>";e+="<div class='dhx_tooltip_date' style='"+o+""+g+"'>"+(c[f]._timed?this.templates.event_date(c[f].start_date):"")+"</div>";e+="<div class='dhx_event_icon icon_details'>\u00a0</div>";e+=this.templates.year_tooltip(c[f].start_date,c[f].end_date,c[f])+
"</div>"}this._tooltip.style.display="";this._tooltip.style.top="0px";this._tooltip.style.left=document.body.offsetWidth-b.left-this._tooltip.offsetWidth<0?b.left-this._tooltip.offsetWidth+"px":b.left+d.offsetWidth+"px";this._tooltip.date=a;this._tooltip.innerHTML=e;this._tooltip.style.top=document.body.offsetHeight-b.top-this._tooltip.offsetHeight<0?b.top-this._tooltip.offsetHeight+d.offsetHeight+"px":b.top+"px"};scheduler._init_year_tooltip=function(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],
"mouseover",function(b){if(a()){var b=b||event,c=b.target||b.srcElement;if(c.tagName.toLowerCase()=="a")c=c.parentNode;(c.className||"").indexOf("dhx_year_event")!=-1?scheduler.showToolTip(e(c.getAttribute("date")),getOffset(c),b,c):scheduler.hideToolTip()}});this._init_year_tooltip=function(){}};scheduler.attachEvent("onSchedulerResize",function(){return a()?(this.year_view(true),false):true});scheduler._get_year_cell=function(a){var b=a.getMonth()+12*(a.getFullYear()-this._min_date.getFullYear())-
this.week_starts._month,c=this._els.dhx_cal_data[0].childNodes[b],a=this.week_starts[b]+a.getDate()-1;return c.childNodes[2].firstChild.rows[Math.floor(a/7)].cells[a%7].firstChild};var g=[];scheduler._mark_year_date=function(a,b){var c=this._get_year_cell(a);c.className="dhx_month_head dhx_year_event "+this.templates.event_class(b.start_date,b.end_date,b);c.setAttribute("date",d(a));g.push(c)};scheduler._unmark_year_date=function(a){this._get_year_cell(a).className="dhx_month_head"};scheduler._year_render_event=
function(a){for(var b=a.start_date,b=b.valueOf()<this._min_date.valueOf()?this._min_date:this.date.date_part(new Date(b));b<a.end_date;)if(this._mark_year_date(b,a),b=this.date.add(b,1,"day"),b.valueOf()>=this._max_date.valueOf())break};scheduler.year_view=function(a){if(a){var b=scheduler.xy.scale_height;scheduler.xy.scale_height=-1}scheduler._els.dhx_cal_header[0].style.display=a?"none":"";scheduler.set_sizes();if(a)scheduler.xy.scale_height=b;scheduler._table_view=a;if(!this._load_mode||!this._load())a?
(scheduler._init_year_tooltip(),scheduler._reset_year_scale(),scheduler.render_view_data()):scheduler.hideToolTip()};scheduler._reset_year_scale=function(){this._cols=[];this._colsS={};var a=[],b=this._els.dhx_cal_data[0],c=this.config;b.scrollTop=0;b.innerHTML="";var d=Math.floor(parseInt(b.style.width)/c.year_x),e=Math.floor((parseInt(b.style.height)-scheduler.xy.year_top)/c.year_y);e<190&&(e=190,d=Math.floor((parseInt(b.style.width)-scheduler.xy.scroll_width)/c.year_x));for(var f=d-11,g=0,o=document.createElement("div"),
v=this.date.week_start(new Date),r=0;r<7;r++)this._cols[r]=Math.floor(f/(7-r)),this._render_x_header(r,g,v,o),v=this.date.add(v,1,"day"),f-=this._cols[r],g+=this._cols[r];o.lastChild.className+=" dhx_scale_bar_last";g=f=this.date[this._mode+"_start"](this.date.copy(this._date));for(r=0;r<c.year_y;r++)for(v=0;v<c.year_x;v++){var t=document.createElement("DIV");t.style.cssText="position:absolute;";t.setAttribute("date",this.templates.xml_format(f));t.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+
o.innerHTML+"</div><div class='dhx_year_body'></div>";t.childNodes[0].innerHTML=this.templates.year_month(f);for(var y=this.date.week_start(f),y=this._reset_month_scale(t.childNodes[2],f,y),B=t.childNodes[2].firstChild.rows,p=B.length;p<6;p++){B[0].parentNode.appendChild(B[0].cloneNode(true));for(var n=0;n<B[p].childNodes.length;n++)B[p].childNodes[n].className="dhx_after",B[p].childNodes[n].firstChild.innerHTML=scheduler.templates.month_day(y),y=scheduler.date.add(y,1,"day")}b.appendChild(t);t.childNodes[1].style.height=
t.childNodes[1].childNodes[0].offsetHeight+"px";y=Math.round((e-190)/2);t.style.marginTop=y+"px";this.set_xy(t,d-10,e-y-10,d*v+5,e*r+5+scheduler.xy.year_top);a[r*c.year_x+v]=(f.getDay()-(this.config.start_on_monday?1:0)+7)%7;f=this.date.add(f,1,"month")}this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](g,f,this._mode);this.week_starts=a;a._month=g.getMonth();this._min_date=g;this._max_date=f}})();
scheduler.form_blocks.recurring={render:function(){return scheduler.__recurring_template},_ds:{},_init_set_value:function(a,b,c){function d(){document.getElementById("dhx_repeat_day").style.display="none";document.getElementById("dhx_repeat_week").style.display="none";document.getElementById("dhx_repeat_month").style.display="none";document.getElementById("dhx_repeat_year").style.display="none";document.getElementById("dhx_repeat_"+this.value).style.display="block"}function e(a){for(var a=h[a],b=
0;b<a.length;b++)if(a[b].checked)return a[b].value}function f(a){for(var b=0;b<a.length;b++){var c=a[b];c.type=="checkbox"||c.type=="radio"?(h[c.name]||(h[c.name]=[]),h[c.name].push(c)):h[c.name]=c}}scheduler.form_blocks.recurring._ds={start:c.start_date,end:c._end_date};var g=scheduler.date.str_to_date(scheduler.config.repeat_date),i=scheduler.date.date_to_str(scheduler.config.repeat_date),a=a.getElementsByTagName("FORM")[0],h=[];f(a.getElementsByTagName("INPUT"));f(a.getElementsByTagName("SELECT"));
scheduler.form_blocks.recurring._get_repeat_code=function(a){var b=[e("repeat")];for(k[b[0]](b,a);b.length<5;)b.push("");var c="";if(h.end[0].checked)a.end=new Date(9999,1,1),c="no";else if(h.end[2].checked)a.end=g(h.date_of_end.value);else{scheduler.transpose_type(b.join("_"));var c=Math.max(1,h.occurences_count.value),d=b[0]=="week"&&b[4]&&b[4].toString().indexOf(scheduler.config.start_on_monday?1:0)==-1?1:0;a.end=scheduler.date.add(new Date(a.start),c+d,b.join("_"))}return b.join("_")+"#"+c};var k=
{month:function(a,b){e("month_type")=="d"?(a.push(Math.max(1,h.month_count.value)),b.start.setDate(h.month_day.value)):(a.push(Math.max(1,h.month_count2.value)),a.push(h.month_day2.value),a.push(Math.max(1,h.month_week2.value)),b.start.setDate(1));b._start=true},week:function(a,b){a.push(Math.max(1,h.week_count.value));a.push("");a.push("");for(var c=[],d=h.week_day,e=0;e<d.length;e++)d[e].checked&&c.push(d[e].value);c.length||c.push(b.start.getDay());b.start=scheduler.date.week_start(b.start);b._start=
true;a.push(c.sort().join(","))},day:function(a){e("day_type")=="d"?a.push(Math.max(1,h.day_count.value)):(a.push("week"),a.push(1),a.push(""),a.push(""),a.push("1,2,3,4,5"),a.splice(0,1))},year:function(a,b){e("year_type")=="d"?(a.push("1"),b.start.setMonth(0),b.start.setDate(h.year_day.value),b.start.setMonth(h.year_month.value)):(a.push("1"),a.push(h.year_day2.value),a.push(h.year_week2.value),b.start.setDate(1),b.start.setMonth(h.year_month2.value));b._start=true}},j={week:function(a){h.week_count.value=
a[1];for(var b=h.week_day,a=a[4].split(","),c={},d=0;d<a.length;d++)c[a[d]]=true;for(d=0;d<b.length;d++)b[d].checked=!!c[b[d].value]},month:function(a,b){a[2]==""?(h.month_type[0].checked=true,h.month_count.value=a[1],h.month_day.value=b.start.getDate()):(h.month_type[1].checked=true,h.month_count2.value=a[1],h.month_week2.value=a[3],h.month_day2.value=a[2])},day:function(a){h.day_type[0].checked=true;h.day_count.value=a[1]},year:function(a,b){a[2]==""?(h.year_type[0].checked=true,h.year_day.value=
b.start.getDate(),h.year_month.value=b.start.getMonth()):(h.year_type[1].checked=true,h.year_week2.value=a[3],h.year_day2.value=a[2],h.year_month2.value=b.start.getMonth())}};scheduler.form_blocks.recurring._set_repeat_code=function(a,b){var c=a.split("#"),a=c[0].split("_");j[a[0]](a,b);var d=h.repeat[{day:0,week:1,month:2,year:3}[a[0]]];switch(c[1]){case "no":h.end[0].checked=true;break;case "":h.end[2].checked=true;h.date_of_end.value=i(b.end);break;default:h.end[1].checked=true,h.occurences_count.value=
c[1]}d.checked=true;d.onclick()};for(b=0;b<a.elements.length;b++)switch(c=a.elements[b],c.name){case "repeat":c.onclick=d}scheduler._lightbox._rec_init_done=true},set_value:function(a,b,c){var d=scheduler.form_blocks.recurring;scheduler._lightbox._rec_init_done||d._init_set_value(a,b,c);a.open=!c.rec_type;a.blocked=c.event_pid&&c.event_pid!="0"?true:false;var e=d._ds;e.start=c.start_date;e.end=c._end_date;d.button_click(0,a.previousSibling.firstChild.firstChild,a,a);b&&d._set_repeat_code(b,e)},get_value:function(a,
b){if(a.open){var c=scheduler.form_blocks.recurring._ds;b.rec_type=scheduler.form_blocks.recurring._get_repeat_code(c);c._start?(b.start_date=new Date(c.start),b._start_date=new Date(c.start),c._start=false):b._start_date=null;b._end_date=b.end_date=c.end;b.rec_pattern=b.rec_type.split("#")[0]}else b.rec_type=b.rec_pattern="",b._end_date=b.end_date;return b.rec_type},focus:function(){},button_click:function(a,b,c,d){!d.open&&!d.blocked?(d.style.height="115px",b.style.backgroundPosition="-5px 0px",
b.nextSibling.innerHTML=scheduler.locale.labels.button_recurring_open):(d.style.height="0px",b.style.backgroundPosition="-5px 20px",b.nextSibling.innerHTML=scheduler.locale.labels.button_recurring);d.open=!d.open;scheduler.setLightboxSize()}};scheduler._rec_markers={};scheduler._rec_markers_pull={};scheduler._add_rec_marker=function(a,b){a._pid_time=b;this._rec_markers[a.id]=a;this._rec_markers_pull[a.event_pid]||(this._rec_markers_pull[a.event_pid]={});this._rec_markers_pull[a.event_pid][b]=a};
scheduler._get_rec_marker=function(a,b){var c=this._rec_markers_pull[b];return c?c[a]:null};scheduler._get_rec_markers=function(a){return this._rec_markers_pull[a]||[]};scheduler._rec_temp=[];scheduler.attachEvent("onEventLoading",function(a){a.event_pid!=0&&scheduler._add_rec_marker(a,a.event_length*1E3);if(a.rec_type)a.rec_pattern=a.rec_type.split("#")[0];return true});
scheduler.attachEvent("onEventIdChange",function(a,b){if(!this._ignore_call){this._ignore_call=true;for(var c=0;c<this._rec_temp.length;c++){var d=this._rec_temp[c];if(d.event_pid==a)d.event_pid=b,this.changeEventId(d.id,b+"#"+d.id.split("#")[1])}delete this._ignore_call}});
scheduler.attachEvent("onBeforeEventDelete",function(a){var b=this.getEvent(a);if(a.toString().indexOf("#")!=-1||b.event_pid&&b.event_pid!="0"&&b.rec_type!="none"){var a=a.split("#"),c=this.uid(),d=a[1]?a[1]:b._pid_time/1E3,e=this._copy_event(b);e.id=c;e.event_pid=b.event_pid||a[0];e.event_length=d;e.rec_type=e.rec_pattern="none";this.addEvent(e);this._add_rec_marker(e,d*1E3)}else for(c in b.rec_type&&this._roll_back_dates(b),b=this._get_rec_markers(a),b)if(b.hasOwnProperty(c))a=b[c].id,this.getEvent(a)&&
this.deleteEvent(a,true);return true});
scheduler.attachEvent("onEventChanged",function(a){if(this._loading)return true;var b=this.getEvent(a);if(a.toString().indexOf("#")!=-1){var a=a.split("#"),c=this.uid();this._not_render=true;b=this._copy_event(b);b.id=c;b.event_pid=a[0];b.event_length=a[1];b.rec_type=b.rec_pattern="";this.addEvent(b);this._not_render=false;this._add_rec_marker(b,a[1]*1E3)}else{b.rec_type&&this._roll_back_dates(b);b=this._get_rec_markers(a);for(c in b)b.hasOwnProperty(c)&&(delete this._rec_markers[b[c].id],this.deleteEvent(b[c].id,
true));delete this._rec_markers_pull[a];b=false;for(c=0;c<this._rendered.length;c++)this._rendered[c].getAttribute("event_id")==a&&(b=true);if(!b)this._select_id=null}return true});scheduler.attachEvent("onEventAdded",function(a){this._loading||(a=this.getEvent(a),a.rec_type&&!a.event_length&&this._roll_back_dates(a));return true});scheduler.attachEvent("onEventSave",function(a,b){if(!this.getEvent(a).rec_type&&b.rec_type&&(a+"").indexOf("#")==-1)this._select_id=null;return true});
scheduler.attachEvent("onEventCreated",function(a){a=this.getEvent(a);if(!a.rec_type)a.rec_type=a.rec_pattern=a.event_length=a.event_pid="";return true});scheduler.attachEvent("onEventCancel",function(a){a=this.getEvent(a);a.rec_type&&(this._roll_back_dates(a),this.render_view_data())});
scheduler._roll_back_dates=function(a){a.event_length=(a.end_date.valueOf()-a.start_date.valueOf())/1E3;a.end_date=a._end_date;a._start_date&&(a.start_date.setMonth(0),a.start_date.setDate(a._start_date.getDate()),a.start_date.setMonth(a._start_date.getMonth()),a.start_date.setFullYear(a._start_date.getFullYear()))};scheduler.validId=function(a){return a.toString().indexOf("#")==-1};scheduler.showLightbox_rec=scheduler.showLightbox;
scheduler.showLightbox=function(a){var b=this.getEvent(a).event_pid;a.toString().indexOf("#")!=-1&&(b=a.split("#")[0]);if(!b||b==0||!this.locale.labels.confirm_recurring||!confirm(this.locale.labels.confirm_recurring))return this.showLightbox_rec(a);b=this.getEvent(b);b._end_date=b.end_date;b.end_date=new Date(b.start_date.valueOf()+b.event_length*1E3);return this.showLightbox_rec(b.id)};scheduler.get_visible_events_rec=scheduler.get_visible_events;
scheduler.get_visible_events=function(){for(var a=0;a<this._rec_temp.length;a++)delete this._events[this._rec_temp[a].id];this._rec_temp=[];for(var b=this.get_visible_events_rec(),c=[],a=0;a<b.length;a++)b[a].rec_type?b[a].rec_pattern!="none"&&this.repeat_date(b[a],c):c.push(b[a]);return c};(function(){var a=scheduler.is_one_day_event;scheduler.is_one_day_event=function(b){return b.rec_type?true:a.call(this,b)}})();scheduler.transponse_size={day:1,week:7,month:1,year:12};
scheduler.date.day_week=function(a,b,c){a.setDate(1);var c=(c-1)*7,d=a.getDay(),b=b*1+c-d+1;a.setDate(b<=c?b+7:b)};scheduler.transpose_day_week=function(a,b,c,d,e){for(var f=(a.getDay()||(scheduler.config.start_on_monday?7:0))-c,g=0;g<b.length;g++)if(b[g]>f)return a.setDate(a.getDate()+b[g]*1-f-(d?c:e));this.transpose_day_week(a,b,c+d,null,c)};
scheduler.transpose_type=function(a){var b="transpose_"+a;if(!this.date[b]){var c=a.split("_"),a="add_"+a,d=this.transponse_size[c[0]]*c[1];if(c[0]=="day"||c[0]=="week"){var e=null;if(c[4]&&(e=c[4].split(","),scheduler.config.start_on_monday)){for(var f=0;f<e.length;f++)e[f]=e[f]*1||7;e.sort()}this.date[b]=function(a,b){var c=Math.floor((b.valueOf()-a.valueOf())/(864E5*d));c>0&&a.setDate(a.getDate()+c*d);e&&scheduler.transpose_day_week(a,e,1,d)};this.date[a]=function(a,b){var c=new Date(a.valueOf());
if(e)for(var f=0;f<b;f++)scheduler.transpose_day_week(c,e,0,d);else c.setDate(c.getDate()+b*d);return c}}else if(c[0]=="month"||c[0]=="year")this.date[b]=function(a,b){var e=Math.ceil((b.getFullYear()*12+b.getMonth()*1-(a.getFullYear()*12+a.getMonth()*1))/d);e>=0&&a.setMonth(a.getMonth()+e*d);c[3]&&scheduler.date.day_week(a,c[2],c[3])},this.date[a]=function(a,b){var e=new Date(a.valueOf());e.setMonth(e.getMonth()+b*d);c[3]&&scheduler.date.day_week(e,c[2],c[3]);return e}}};
scheduler.repeat_date=function(a,b,c,d,e){var d=d||this._min_date,e=e||this._max_date,f=new Date(a.start_date.valueOf());if(!a.rec_pattern&&a.rec_type)a.rec_pattern=a.rec_type.split("#")[0];this.transpose_type(a.rec_pattern);for(scheduler.date["transpose_"+a.rec_pattern](f,d);f<a.start_date||f.valueOf()+a.event_length*1E3<=d.valueOf();)f=this.date.add(f,1,a.rec_pattern);for(;f<e&&f<a.end_date;){if(d=this._get_rec_marker(f.valueOf(),a.id))c&&b.push(d);else{var g=new Date(f.valueOf()+a.event_length*
1E3),d=this._copy_event(a);d.text=a.text;d.start_date=f;d.event_pid=a.id;d.id=a.id+"#"+Math.ceil(f.valueOf()/1E3);d.end_date=g;if(g=d.start_date.getTimezoneOffset()-d.end_date.getTimezoneOffset())d.end_date=g>0?new Date(f.valueOf()+a.event_length*1E3-g*6E4):new Date(d.end_date.valueOf()+g*6E4);d._timed=this.is_one_day_event(d);if(!d._timed&&!this._table_view&&!this.config.multi_day)break;b.push(d);c||(this._events[d.id]=d,this._rec_temp.push(d))}f=this.date.add(f,1,a.rec_pattern)}};
scheduler.getRecDates=function(a,b){var c=typeof a=="object"?a:scheduler.getEvent(a),d=0,e=[],b=b||1E3,f=new Date(c.start_date.valueOf()),g=new Date(f.valueOf());if(!c.rec_type)return[{start_date:c.start_date,end_date:c.end_date}];this.transpose_type(c.rec_pattern);for(scheduler.date["transpose_"+c.rec_pattern](f,g);f<c.start_date||f.valueOf()+c.event_length*1E3<=g.valueOf();)f=this.date.add(f,1,c.rec_pattern);for(;f<c.end_date;){var g=this._get_rec_marker(f.valueOf(),c.id),i=true;g?g.rec_type=="none"?
i=false:e.push({start_date:g.start_date,end_date:g.end_date}):e.push({start_date:new Date(f),end_date:new Date(f.valueOf()+c.event_length*1E3)});f=this.date.add(f,1,c.rec_pattern);if(i&&(d++,d==b))break}return e};
scheduler.getEvents=function(a,b){var c=[],d;for(d in this._events){var e=this._events[d];if(e&&e.start_date<b&&e.end_date>a)if(e.rec_pattern){if(e.rec_pattern!="none"){var f=[];this.repeat_date(e,f,true,a,b);for(e=0;e<f.length;e++)!f[e].rec_pattern&&f[e].start_date<b&&f[e].end_date>a&&!this._rec_markers[f[e].id]&&c.push(f[e])}}else e.id.toString().indexOf("#")==-1&&c.push(e)}return c};scheduler.config.repeat_date="%m.%d.%Y";
scheduler.config.lightbox.sections=[{name:"description",height:130,map_to:"text",type:"textarea",focus:true},{name:"recurring",type:"recurring",map_to:"rec_type",button:"recurring"},{name:"time",height:72,type:"time",map_to:"auto"}];scheduler._copy_dummy=function(){this.start_date=new Date(this.start_date);this.end_date=new Date(this.end_date);this.event_length=this.event_pid=this.rec_pattern=this.rec_type=this._timed=null};
scheduler.__recurring_template='<div class="dhx_form_repeat"> <form> <div class="dhx_repeat_left"> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="day" />Daily</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="week"/>Weekly</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="month" checked />Monthly</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="year" />Yearly</label> </div> <div class="dhx_repeat_divider"></div> <div class="dhx_repeat_center"> <div style="display:none;" id="dhx_repeat_day"> <label><input class="dhx_repeat_radio" type="radio" name="day_type" value="d"/>Every</label><input class="dhx_repeat_text" type="text" name="day_count" value="1" />day<br /> <label><input class="dhx_repeat_radio" type="radio" name="day_type" checked value="w"/>Every workday</label> </div> <div style="display:none;" id="dhx_repeat_week"> Repeat every<input class="dhx_repeat_text" type="text" name="week_count" value="1" />week next days:<br /> <table class="dhx_repeat_days"> <tr> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="1" />Monday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="4" />Thursday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="2" />Tuesday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="5" />Friday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="3" />Wednesday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="6" />Saturday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="0" />Sunday</label><br /><br /> </td> </tr> </table> </div> <div id="dhx_repeat_month"> <label><input class="dhx_repeat_radio" type="radio" name="month_type" value="d"/>Repeat</label><input class="dhx_repeat_text" type="text" name="month_day" value="1" />day every<input class="dhx_repeat_text" type="text" name="month_count" value="1" />month<br /> <label><input class="dhx_repeat_radio" type="radio" name="month_type" checked value="w"/>On</label><input class="dhx_repeat_text" type="text" name="month_week2" value="1" /><select name="month_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="0">Sunday</select>every<input class="dhx_repeat_text" type="text" name="month_count2" value="1" />month<br /> </div> <div style="display:none;" id="dhx_repeat_year"> <label><input class="dhx_repeat_radio" type="radio" name="year_type" value="d"/>Every</label><input class="dhx_repeat_text" type="text" name="year_day" value="1" />day<select name="year_month"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select>month<br /> <label><input class="dhx_repeat_radio" type="radio" name="year_type" checked value="w"/>On</label><input class="dhx_repeat_text" type="text" name="year_week2" value="1" /><select name="year_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="7">Sunday</select>of<select name="year_month2"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select><br /> </div> </div> <div class="dhx_repeat_divider"></div> <div class="dhx_repeat_right"> <label><input class="dhx_repeat_radio" type="radio" name="end" checked/>No end date</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="end" />After</label><input class="dhx_repeat_text" type="text" name="occurences_count" value="1" />occurrences<br /> <label><input class="dhx_repeat_radio" type="radio" name="end" />End by</label><input class="dhx_repeat_date" type="text" name="date_of_end" value="'+scheduler.config.repeat_date_of_end+
'" /><br /> </div> </form> </div> <div style="clear:both"> </div>';
scheduler.attachEvent("onTimelineCreated",function(a){if(a.render=="tree")a.y_unit_original=a.y_unit,a.y_unit=scheduler._getArrayToDisplay(a.y_unit_original),scheduler.attachEvent("onOptionsLoadStart",function(){a.y_unit=scheduler._getArrayToDisplay(a.y_unit_original)}),scheduler.form_blocks[a.name]={render:function(a){return"<div class='dhx_section_timeline' style='overflow: hidden; height: "+a.height+"px'></div>"},set_value:function(a,c,d,e){c=scheduler._getArrayForSelect(scheduler.matrix[e.type].y_unit_original,
e.type);a.innerHTML="";var f=document.createElement("select");a.appendChild(f);a=a.getElementsByTagName("select")[0];for(f=0;f<c.length;f++){var g=document.createElement("option");g.value=c[f].key;if(g.value==d[scheduler.matrix[e.type].y_property])g.selected=true;g.innerHTML=c[f].label;a.appendChild(g)}},get_value:function(a){return a.firstChild.value},focus:function(){}}});
scheduler.attachEvent("onBeforeViewRender",function(a,b,c){var d={};if(a=="tree"){var e,f,g,i,h,k;b.children?(e=c.folder_dy||c.dy,c.folder_dy&&!c.section_autoheight&&(g="height:"+c.folder_dy+"px;"),f="dhx_row_folder",i="dhx_matrix_scell folder",h="<div class='dhx_scell_expand'>"+(b.open?"-":"+")+"</div>",k=c.folder_events_available?"dhx_data_table folder_events":"dhx_data_table folder"):(e=c.dy,f="dhx_row_item",i="dhx_matrix_scell item",h="",k="dhx_data_table");td_content="<div class='dhx_scell_level"+
b.level+"'>"+h+"<div class='dhx_scell_name'>"+(scheduler.templates[c.name+"_scale_label"](b.key,b.label,b)||b.label)+"</div></div>";d={height:e,style_height:g,tr_className:f,td_className:i,td_content:td_content,table_className:k}}return d});var section_id_before;
scheduler.attachEvent("onBeforeEventChanged",function(a,b,c){return scheduler._isRender("tree")&&typeof scheduler.getSection(a[scheduler.matrix[scheduler._mode].y_property]).children!="undefined"&&!scheduler.matrix[scheduler._mode].folder_events_available?(c||(a[scheduler.matrix[scheduler._mode].y_property]=section_id_before),false):true});
scheduler.attachEvent("onBeforeDrag",function(a,b,c){if(b=scheduler._locate_cell_timeline(c)){var d=scheduler.matrix[scheduler._mode].y_unit[b.y].key;if(typeof scheduler.matrix[scheduler._mode].y_unit[b.y].children!="undefined"&&!scheduler.matrix[scheduler._mode].folder_events_available)return false}scheduler._isRender("tree")&&(ev=scheduler.getEvent(a),section_id_before=d||ev[scheduler.matrix[scheduler._mode].y_property]);return true});
scheduler._getArrayToDisplay=function(a){var b=[],c=function(a,e){for(var f=e||0,g=0;g<a.length;g++){a[g].level=f;if(typeof a[g].children!="undefined"&&typeof a[g].key=="undefined")a[g].key=scheduler.uid();b.push(a[g]);a[g].open&&a[g].children&&c(a[g].children,f+1)}};c(a);return b};
scheduler._getArrayForSelect=function(a,b){var c=[],d=function(a){for(var f=0;f<a.length;f++)scheduler.matrix[b].folder_events_available?c.push(a[f]):typeof a[f].children=="undefined"&&c.push(a[f]),a[f].children&&d(a[f].children,b)};d(a);return c};
scheduler._toggleFolderDisplay=function(a,b,c){var d=function(a,b,c,i){for(var h=0;h<b.length;h++){if((b[h].key==a||i)&&b[h].children)if(b[h].open=typeof c!="undefined"?c:!b[h].open,!i&&true)break;b[h].children&&d(a,b[h].children,c,i)}};d(a,scheduler.matrix[scheduler._mode].y_unit_original,b,c);scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original);scheduler.callEvent("onOptionsLoad",[])};
scheduler.attachEvent("onCellClick",function(a,b){scheduler._isRender("tree")&&(scheduler.matrix[scheduler._mode].folder_events_available||typeof scheduler.matrix[scheduler._mode].y_unit[b].children!="undefined"&&scheduler._toggleFolderDisplay(scheduler.matrix[scheduler._mode].y_unit[b].key))});scheduler.attachEvent("onYScaleClick",function(a,b){scheduler._isRender("tree")&&typeof b.children!="undefined"&&scheduler._toggleFolderDisplay(b.key)});
scheduler.getSection=function(a){if(scheduler._isRender("tree")){var b,c=function(a,e){for(var f=0;f<e.length;f++)e[f].key==a&&(b=e[f]),e[f].children&&c(a,e[f].children)};c(a,scheduler.matrix[scheduler._mode].y_unit_original);return b||null}};
scheduler.deleteSection=function(a){if(scheduler._isRender("tree")){var b=false,c=function(a,e){for(var f=0;f<e.length;f++){e[f].key==a&&(e.splice(f,1),b=true);if(b)break;e[f].children&&c(a,e[f].children)}};c(a,scheduler.matrix[scheduler._mode].y_unit_original);scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original);scheduler.callEvent("onOptionsLoad",[]);return b}};
scheduler.deleteAllSections=function(){if(scheduler._isRender("tree"))scheduler.matrix[scheduler._mode].y_unit_original=[],scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[])};
scheduler.addSection=function(a,b){if(scheduler._isRender("tree")){var c=false,d=function(a,f,g){if(b)for(var i=0;i<g.length;i++){g[i].key==f&&typeof g[i].children!="undefined"&&(g[i].children.push(a),c=true);if(c)break;g[i].children&&d(a,f,g[i].children)}else g.push(a),c=true};d(a,b,scheduler.matrix[scheduler._mode].y_unit_original);scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original);scheduler.callEvent("onOptionsLoad",[]);return c}};
scheduler.openAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,true,true)};scheduler.closeAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,false,true)};scheduler.openSection=function(a){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(a,true)};scheduler.closeSection=function(a){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(a,false)};
(function(){var a=true;scheduler.attachEvent("onBeforeViewChange",function(b,c,d,e){if(a){a=false;var f;a:{if(document.cookie.length>0&&(f=document.cookie.indexOf("scheduler_settings="),f!=-1)){f+=19;var g=document.cookie.indexOf(";",f);if(g==-1)g=document.cookie.length;f=document.cookie.substring(f,g);break a}f=""}if(f)return f=f.split("@"),f[0]=this.templates.xml_date(f[0]),this.setCurrentView(f[0],f[1]),false}b=this.templates.xml_format(e||c)+"@"+(d||b);document.cookie="scheduler_settings="+b+
"; expires=Sun, 31 Jan 9999 22:00:00 GMT";return true})})();(function(){function a(a){var b=function(){};b.prototype=a;return b}var b=scheduler._load;scheduler._load=function(c,d){c=c||this._load_url;if(typeof c=="object")for(var e=a(this._loaded),f=0;f<c.length;f++)this._loaded=new e,b.call(this,c[f],d);else b.apply(this,arguments)}})();
scheduler.expand=function(){var a=scheduler._obj;do a._position=a.style.position||"",a.style.position="static";while((a=a.parentNode)&&a.style);a=scheduler._obj;a.style.position="absolute";a._width=a.style.width;a._height=a.style.height;a.style.width=a.style.height="100%";a.style.top=a.style.left="0px";a=document.body;a.scrollTop=0;if(a=a.parentNode)a.scrollTop=0;document.body._overflow=document.body.style.overflow||"";document.body.style.overflow="hidden";scheduler._maximize()};
scheduler.collapse=function(){var a=scheduler._obj;do a.style.position=a._position;while((a=a.parentNode)&&a.style);a=scheduler._obj;a.style.width=a._width;a.style.height=a._height;document.body.style.overflow=document.body._overflow;scheduler._maximize()};scheduler.attachEvent("onTemplatesReady",function(){var a=document.createElement("DIV");a.className="dhx_expand_icon";scheduler.toggleIcon=a;scheduler._obj.appendChild(a);a.onclick=function(){scheduler.expanded?scheduler.collapse():scheduler.expand()}});
scheduler._maximize=function(){this.expanded=!this.expanded;this.toggleIcon.style.backgroundPosition="0px "+(this.expanded?"0":"18")+"px";for(var a=["left","top"],b=0;b<a.length;b++){var c=scheduler["_prev_margin_"+a[b]];scheduler.xy["margin_"+a[b]]?(scheduler["_prev_margin_"+a[b]]=scheduler.xy["margin_"+a[b]],scheduler.xy["margin_"+a[b]]=0):c&&(scheduler.xy["margin_"+a[b]]=scheduler["_prev_margin_"+a[b]],delete scheduler["_prev_margin_"+a[b]])}scheduler.callEvent("onSchedulerResize",[])&&scheduler.update_view()};
scheduler.attachEvent("onTemplatesReady",function(){function a(a,b,c,d){for(var b=b.getElementsByTagName(a),a=c.getElementsByTagName(a),h=a.length-1;h>=0;h--)if(c=a[h],d){var k=document.createElement("SPAN");k.className="dhx_text_disabled";k.innerHTML=d(b[h]);c.parentNode.insertBefore(k,c);c.parentNode.removeChild(c)}else c.disabled=true}scheduler.attachEvent("onBeforeLightbox",function(a){if(this.config.readonly_form||this.getEvent(a).readonly)this.config.readonly_active=true;else return this.config.readonly_active=
false,true;for(a=0;a<this.config.lightbox.sections.length;a++)this.config.lightbox.sections[a].focus=false;return true});var b=scheduler._fill_lightbox;scheduler._fill_lightbox=function(){var d=this.config.lightbox.sections;if(this.config.readonly_active)for(var f=0;f<d.length;f++)if(d[f].type=="recurring"){var g=document.getElementById(d[f].id);g.style.display=g.nextSibling.style.display="none";d.splice(f,1);f--}d=b.apply(this,arguments);if(this.config.readonly_active)f=this._get_lightbox(),g=this._lightbox_r=
f.cloneNode(true),g.id=scheduler.uid(),g.style.color="red",a("textarea",f,g,function(a){return a.value}),a("input",f,g,false),a("select",f,g,function(a){return a.options[Math.max(a.selectedIndex||0,0)].text}),g.removeChild(g.childNodes[2]),g.removeChild(g.childNodes[3]),f.parentNode.insertBefore(g,f),c.call(this,g),scheduler._lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),this._lightbox=g,this.setLightboxSize(),this._lightbox=null,g.onclick=function(a){a=a?a.target:event.srcElement;
if(!a.className)a=a.previousSibling;if(a&&a.className)switch(a.className){case "dhx_cancel_btn":scheduler.callEvent("onEventCancel",[scheduler._lightbox_id]),scheduler._edit_stop_event(scheduler.getEvent(scheduler._lightbox_id),false),scheduler.hide_lightbox()}};return d};var c=scheduler.showCover;scheduler.showCover=function(){this.config.readonly_active||c.apply(this,arguments)};var d=scheduler.hide_lightbox;scheduler.hide_lightbox=function(){if(this._lightbox_r)this._lightbox_r.parentNode.removeChild(this._lightbox_r),
this._lightbox_r=null;return d.apply(this,arguments)}});
(function(){function a(a){var b=[];if(a.rec_type){for(var d=scheduler.getRecDates(a),i=0;i<d.length;i++)for(var h=scheduler.getEvents(d[i].start_date,d[i].end_date),k=0;k<h.length;k++)(h[k].event_pid||h[k].id)!=a.id&&b.push(h[k]);b.push(a)}else b=scheduler.getEvents(a.start_date,a.end_date);i=scheduler._props?scheduler._props[scheduler._mode]:null;h=scheduler.matrix?scheduler.matrix[scheduler._mode]:null;d=i||h;if(i)var j=d.map_to;if(h)j=d.y_property;i=true;if(d){for(h=d=0;h<b.length;h++)b[h][j]==
a[j]&&b[h].id!=a.id&&d++;d>=scheduler.config.collision_limit&&(a[j]=c,i=false)}else b.length>scheduler.config.collision_limit&&(i=false);return!i?!scheduler.callEvent("onEventCollision",[a,b]):i}function b(a){var b=scheduler._props?scheduler._props[scheduler._mode]:null,d=scheduler.matrix?scheduler.matrix[scheduler._mode]:null,i=b||d;if(b)var h=i.map_to;if(d)h=i.y_property;i&&a&&(c=scheduler.getEvent(a)[h])}var c,d;scheduler.config.collision_limit=1;scheduler.attachEvent("onBeforeDrag",function(a){b(a);
return true});scheduler.attachEvent("onBeforeLightbox",function(a){var c=scheduler.getEvent(a);d=[c.start_date,c.end_date];b(a);return true});scheduler.attachEvent("onEventChanged",function(b){if(!b)return true;b=scheduler.getEvent(b);if(!a(b)){if(!d)return false;b.start_date=d[0];b.end_date=d[1];b._timed=this.is_one_day_event(b)}return true});scheduler.attachEvent("onBeforeEventChanged",function(b){return a(b)});scheduler.attachEvent("onEventSave",function(b,c){return c.rec_type?(scheduler._roll_back_dates(c),
a(c)):true})})();
scheduler.toPDF=function(a,b,c,d){function e(a,b){return(window.getComputedStyle?window.getComputedStyle(a,null)[b]:a.currentStyle?a.currentStyle[b]:null)||""}function f(a){for(var b="",c=a.firstChild.rows,d=0;d<c.length;d++){for(var e=[],f=0;f<c[d].cells.length;f++)e.push(c[d].cells[f].firstChild.innerHTML);b+="\n<row height='"+a.firstChild.rows[d].cells[0].offsetHeight+"'><![CDATA["+k(e.join("|"))+"]]\></row>";l=a.firstChild.rows[0].cells[0].offsetHeight}return b}function g(a){var b="";if(scheduler.matrix&&
scheduler.matrix[scheduler._mode])a=a[0].childNodes;for(var c=0;c<a.length;c++)b+="\n<column><![CDATA["+k(a[c].innerHTML)+"]]\></column>";j=a[0].offsetWidth;return b}function i(a){a=parseFloat(a);return isNaN(a)?"auto":100*a/l}function h(a){a=parseFloat(a);return isNaN(a)?"auto":100*a/(j+1)}function k(a){return a.replace(html_regexp,"")}var j=0,l=0,m=false;b=="fullcolor"&&(m=true,b="color");b=b||"color";html_regexp=RegExp("<[^>]*>","g");var A=(new Date).valueOf(),o=document.createElement("div");o.style.display=
"none";document.body.appendChild(o);o.innerHTML='<form id="'+A+'" method="post" target="_blank" action="'+a+'" accept-charset="utf-8" enctype="application/x-www-form-urlencoded"><input type="hidden" name="mycoolxmlbody"/> </form>';document.getElementById(A).firstChild.value=function(a){a="<data profile='"+a+"'";c&&(a+=" header='"+c+"'");d&&(a+=" footer='"+d+"'");a+=">";a+="<scale mode='"+scheduler._mode+"' today='"+scheduler._els.dhx_cal_date[0].innerHTML+"'>";if(scheduler._mode=="agenda"){var b=
scheduler._els.dhx_cal_header[0].childNodes[0].childNodes;a+="<column>"+k(b[0].innerHTML)+"</column><column>"+k(b[1].innerHTML)+"</column>"}else if(scheduler._mode=="year")for(var b=scheduler._els.dhx_cal_data[0].childNodes,e=0;e<b.length;e++)a+="<month label='"+k(b[e].childNodes[0].innerHTML)+"'>",a+=g(b[e].childNodes[1].childNodes),a+=f(b[e].childNodes[2]),a+="</month>";else if(a+="<x>",b=scheduler._els.dhx_cal_header[0].childNodes,a+=g(b),a+="</x>",b=scheduler._els.dhx_cal_data[0],scheduler.matrix&&
scheduler.matrix[scheduler._mode]){a+="<y>";for(e=0;e<b.firstChild.rows.length;e++)a+="<row><![CDATA["+b.firstChild.rows[e].cells[0].innerHTML+"]]\></row>";a+="</y>";l=b.firstChild.rows[0].cells[0].offsetHeight}else if(b.firstChild.tagName=="TABLE")a+=f(b);else{for(b=b.childNodes[b.childNodes.length-1];b.className.indexOf("dhx_scale_holder")==-1;)b=b.previousSibling;b=b.childNodes;a+="<y>";for(e=0;e<b.length;e++)a+="\n<row><![CDATA["+k(b[e].innerHTML)+"]]\></row>";a+="</y>";l=b[0].offsetHeight}a+=
"</scale>";return a}(b).replace("\u2013","-")+function(){var a="",b=scheduler._rendered;if(scheduler._mode=="agenda")for(var c=0;c<b.length;c++)a+="<event><head>"+k(b[c].childNodes[0].innerHTML)+"</head><body>"+k(b[c].childNodes[2].innerHTML)+"</body></event>";else if(scheduler._mode=="year"){b=scheduler.get_visible_events();for(c=0;c<b.length;c++){var d=b[c].start_date;if(d.valueOf()<scheduler._min_date.valueOf())d=scheduler._min_date;for(;d<b[c].end_date;){var f=d.getMonth()+12*(d.getFullYear()-
scheduler._min_date.getFullYear())-scheduler.week_starts._month,g=scheduler.week_starts[f]+d.getDate()-1;a+="<event day='"+g%7+"' week='"+Math.floor(g/7)+"' month='"+f+"'></event>";d=scheduler.date.add(d,1,"day");if(d.valueOf()>=scheduler._max_date.valueOf())break}}}else for(c=0;c<b.length;c++){var d=h(b[c].style.left),f=h(b[c].style.width),j=i(b[c].style.top),q=i(b[c].style.height),o=b[c].className.split(" ")[0].replace("dhx_cal_",""),C=scheduler.getEvent(b[c].getAttribute("event_id")),g=C._sday,
C=C._sweek;if(scheduler._mode!="month"){if(scheduler.matrix&&scheduler.matrix[scheduler._mode])g=0,C=b[c].parentNode.parentNode.parentNode.rowIndex,f+=h(10);else{f+=h(f*20/100);d-=h(20-d*20/100);if(b[c].parentNode==scheduler._els.dhx_cal_data[0])continue;d+=h(b[c].parentNode.style.left);d-=h(51)}if(scheduler._mode=="timeline"){var D=l;l=180;j=i(b[c].style.top);l=D}}else{q=parseInt(b[c].offsetHeight);j=parseInt(b[c].style.top)-22;a:for(var D=parseInt(b[c].style.left),u=0;u<scheduler._cols.length;u++)if(D-=
scheduler._cols[u],D<0){g=u;break a}a:{D=parseInt(b[c].style.top);for(u=0;u<scheduler._colsS.heights.length;u++)if(scheduler._colsS.heights[u]>D){C=u;break a}}}a+="\n<event week='"+C+"' day='"+g+"' type='"+o+"' x='"+d+"' y='"+j+"' width='"+f+"' height='"+q+"'>";if(o=="event"){a+="<header><![CDATA["+k(b[c].childNodes[1].innerHTML)+"]]\></header>";var A=m?e(b[c].childNodes[2],"color"):"",E=m?e(b[c].childNodes[2],"backgroundColor"):"";a+="<body backgroundColor='"+E+"' color='"+A+"'><![CDATA["+k(b[c].childNodes[2].innerHTML)+
"]]\></body>"}else A=m?e(b[c],"color"):"",E=m?e(b[c],"backgroundColor"):"",a+="<body backgroundColor='"+E+"' color='"+A+"'><![CDATA["+k(b[c].innerHTML)+"]]\></body>";a+="</event>"}return a}()+"</data>";document.getElementById(A).submit();o.parentNode.removeChild(o);grid=null};scheduler.data_attributes=function(){var a=[],b=scheduler.templates.xml_format,c;for(c in this._events){c=this._events[c];for(var d in c)d.substr(0,1)!="_"&&a.push([d,d=="start_date"||d=="end_date"?b:null]);break}return a};
scheduler.toXML=function(a){var b=[],c=this.data_attributes(),d;for(d in this._events){var e=this._events[d];if(e.id.toString().indexOf("#")==-1){b.push("<event>");for(var f=0;f<c.length;f++)b.push("<"+c[f][0]+"><![CDATA["+(c[f][1]?c[f][1](e[c[f][0]]):e[c[f][0]])+"]]\></"+c[f][0]+">");b.push("</event>")}}return(a||"")+"<data>"+b.join("\n")+"</data>"};
scheduler.toJSON=function(){var a=[],b=this.data_attributes(),c;for(c in this._events){var d=this._events[c];if(d.id.toString().indexOf("#")==-1){for(var d=this._events[c],e=[],f=0;f<b.length;f++)e.push(" "+b[f][0]+':"'+((b[f][1]?b[f][1](d[b[f][0]]):d[b[f][0]])||"").toString().replace(/\n/g,"")+'" ');a.push("{"+e.join(",")+"}")}}return"["+a.join(",\n")+"]"};
scheduler.toICal=function(a){var b=scheduler.date.date_to_str("%Y%m%dT%H%i%s"),c=[],d;for(d in this._events){var e=this._events[d];e.id.toString().indexOf("#")==-1&&(c.push("BEGIN:VEVENT"),c.push("DTSTART:"+b(e.start_date)),c.push("DTEND:"+b(e.end_date)),c.push("SUMMARY:"+e.text),c.push("END:VEVENT"))}return"BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//dhtmlXScheduler//NONSGML v2.2//EN\nDESCRIPTION:"+(a||"")+"\n"+c.join("\n")+"\nEND:VCALENDAR"};window.dhtmlXTooltip={version:0.1};
dhtmlXTooltip.config={className:"dhtmlXTooltip tooltip",timeout_to_display:50,delta_x:15,delta_y:-20};dhtmlXTooltip.tooltip=document.createElement("div");dhtmlXTooltip.tooltip.className=dhtmlXTooltip.config.className;
dhtmlXTooltip.show=function(a,b){dhtmlXTooltip.tooltip.className=dhtmlXTooltip.config.className;var c=this.position(a);if(!this.isTooltip(a.target||a.srcElement)){var d=c.x+dhtmlXTooltip.config.delta_x||0,e=c.y-dhtmlXTooltip.config.delta_y||0;this.tooltip.style.visibility="hidden";this.tooltip.style.removeAttribute?(this.tooltip.style.removeAttribute("right"),this.tooltip.style.removeAttribute("bottom")):(this.tooltip.style.removeProperty("right"),this.tooltip.style.removeProperty("bottom"));this.tooltip.style.left=
"0px";this.tooltip.style.top="0px";this.tooltip.innerHTML=b;scheduler._obj.appendChild(this.tooltip);var f=this.tooltip.offsetHeight;document.body.offsetWidth-d-this.tooltip.offsetWidth<0?(this.tooltip.style.removeAttribute?this.tooltip.style.removeAttribute("left"):this.tooltip.style.removeProperty("left"),this.tooltip.style.right=(document.body.offsetWidth-d+2*dhtmlXTooltip.config.delta_x||0)+"px"):this.tooltip.style.left=d<0?c.x+Math.abs(dhtmlXTooltip.config.delta_x||0)+"px":d+"px";document.body.offsetHeight-
e-f<0?(this.tooltip.style.removeAttribute?this.tooltip.style.removeAttribute("top"):this.tooltip.style.removeProperty("top"),this.tooltip.style.bottom=(document.body.offsetHeight-e-2*dhtmlXTooltip.config.delta_y||0)+"px"):this.tooltip.style.top=e<0?c.y+Math.abs(dhtmlXTooltip.config.delta_y||0)+"px":e+"px";this.tooltip.style.visibility="visible"}};dhtmlXTooltip.hide=function(){this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip)};
dhtmlXTooltip.delay=function(a,b,c,d){this.tooltip._timeout_id&&window.clearTimeout(this.tooltip._timeout_id);this.tooltip._timeout_id=setTimeout(function(){var d=a.apply(b,c);a=obj=c=null;return d},d||this.config.timeout_to_display)};dhtmlXTooltip.isTooltip=function(a){for(var b=false;a&&!b;)b=a.className==this.tooltip.className,a=a.parentNode;return b};
dhtmlXTooltip.position=function(a){a=a||window.event;if(a.pageX||a.pageY)return{x:a.pageX,y:a.pageY};var b=dhtmlx._isIE&&document.compatMode!="BackCompat"?document.documentElement:document.body;return{x:a.clientX+b.scrollLeft-b.clientLeft,y:a.clientY+b.scrollTop-b.clientTop}};
scheduler.attachEvent("onMouseMove",function(a,b){var c=b||window.event,d=c.target||c.srcElement;if(a||dhtmlXTooltip.isTooltip(d)){d=scheduler.getEvent(a)||scheduler.getEvent(dhtmlXTooltip.tooltip.event_id);dhtmlXTooltip.tooltip.event_id=d.id;d=scheduler.templates.tooltip_text(d.start_date,d.end_date,d);if(_isIE)var e=document.createEventObject(c);dhtmlXTooltip.delay(dhtmlXTooltip.show,dhtmlXTooltip,[e||c,d])}else dhtmlXTooltip.delay(dhtmlXTooltip.hide,dhtmlXTooltip,[])});
scheduler.templates.tooltip_text=function(a,b,c){return"<b>Event:</b> "+c.text+"<br/><b>Start date:</b> "+scheduler.templates.tooltip_date_format(a)+"<br/><b>End date:</b> "+scheduler.templates.tooltip_date_format(b)};scheduler._props={};
scheduler.createUnitsView=function(a,b,c,d,e){if(typeof a=="object")c=a.list,b=a.property,d=a.size||0,e=a.step||1,a=a.name;scheduler.date[a+"_start"]=scheduler.date.day_start;scheduler.templates[a+"_date"]=function(a){return scheduler.templates.day_date(a)};scheduler.templates[a+"_scale_date"]=function(b){if(!c.length)return"";b=(scheduler._props[a].position||0)+Math.floor((scheduler._correct_shift(b.valueOf(),1)-scheduler._min_date.valueOf())/864E5);return c[b].css?"<span class='"+c[b].css+"'>"+
c[b].label+"</span>":c[b].label};scheduler.date["add_"+a]=function(a,b){return scheduler.date.add(a,b,"day")};scheduler.date["get_"+a+"_end"]=function(a){return scheduler.date.add(a,d||c.length,"day")};scheduler._props[a]={map_to:b,options:c,size:d,step:e,position:0};scheduler.attachEvent("onOptionsLoad",function(){for(var b=scheduler._props[a].order={},d=0;d<c.length;d++)b[c[d].key]=d;scheduler._date&&scheduler.setCurrentView(scheduler._date,scheduler._mode)});scheduler.callEvent("onOptionsLoad",
[])};scheduler.scrollUnit=function(a){var b=scheduler._props[this._mode];if(b)b.position=Math.min(Math.max(0,b.position+a),b.options.length-b.size),this.update_view()};
(function(){var a=function(a,b){if(a&&typeof a.order[b[a.map_to]]=="undefined")return b[a.map_to]=a.options[Math.min(Math.floor((b.end_date-scheduler._min_date)/864E5)+a.position,a.options.length-1)].key,true},b=scheduler._reset_scale,c=scheduler.is_visible_events;scheduler.is_visible_events=function(a){var b=c.apply(this,arguments);if(b){var d=scheduler._props[this._mode];if(d&&d.size){var e=d.order[a[d.map_to]];if(e<d.position||e>=d.size+d.position)return false}}return b};scheduler._reset_scale=
function(){var a=scheduler._props[this._mode],c=b.apply(this,arguments);if(a){this._max_date=this.date.add(this._min_date,1,"day");for(var d=this._els.dhx_cal_data[0].childNodes,e=0;e<d.length;e++)d[e].className=d[e].className.replace("_now","");if(a.size&&a.size<a.options.length){d=this._els.dhx_cal_header[0];e=document.createElement("DIV");if(a.position)e.className="dhx_cal_prev_button",e.style.cssText="left:1px;top:2px;position:absolute;",e.innerHTML="\u00a0",d.firstChild.appendChild(e),e.onclick=
function(){scheduler.scrollUnit(a.step*-1)};if(a.position+a.size<a.options.length)e=document.createElement("DIV"),e.className="dhx_cal_next_button",e.style.cssText="left:auto; right:0px;top:2px;position:absolute;",e.innerHTML="\u00a0",d.lastChild.appendChild(e),e.onclick=function(){scheduler.scrollUnit(a.step)}}}return c};var d=scheduler._get_event_sday;scheduler._get_event_sday=function(b){var c=scheduler._props[this._mode];return c?(a(c,b),c.order[b[c.map_to]]-c.position):d.call(this,b)};var e=
scheduler.locate_holder_day;scheduler.locate_holder_day=function(b,c,d){var f=scheduler._props[this._mode];return f?(a(f,d),f.order[d[f.map_to]]*1+(c?1:0)-f.position):e.apply(this,arguments)};var f=scheduler._mouse_coords;scheduler._mouse_coords=function(){var a=scheduler._props[this._mode],b=f.apply(this,arguments);if(a){var c=this._drag_event;if(this._drag_id)c=this.getEvent(this._drag_id),this._drag_event._dhx_changed=true;var d=Math.min(b.x+a.position,a.options.length-1);c[a.map_to]=a.options[d].key;
b.x=d/1E7}return b};var g=scheduler._time_order;scheduler._time_order=function(a){var b=scheduler._props[this._mode];b?a.sort(function(a,c){return b.order[a[b.map_to]]>b.order[c[b.map_to]]?1:-1}):g.apply(this,arguments)};scheduler.attachEvent("onEventAdded",function(a,b){if(this._loading)return true;for(var c in scheduler._props){var d=scheduler._props[c];if(typeof b[d.map_to]=="undefined")b[d.map_to]=d.options[0].key}return true});scheduler.attachEvent("onEventCreated",function(b,c){var d=scheduler._props[this._mode];
if(d){var e=this.getEvent(b);this._mouse_coords(c);a(d,e);this.event_updated(e)}return true})})();