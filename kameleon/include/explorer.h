<?php	//22-09-2003, Robert Posiadala, przenioslem style do kameleon.css aby mozliwe bylo ich nadpisywanie	//ustawienie parametrow, do muliti tez		if (strlen($lng))		$lang=$lng;	else		$lng=$lang;			if ($multi)	{		$SQL="SELECT DISTINCT lang AS l FROM webpage WHERE server=$SERVER_ID AND prev=-1";		//$langres=pg_Exec($db,$SQL);		$langres = $adodb->Execute($SQL);		$ile = $langres->RecordCount();		for ($i=0; $i<$ile; $i++)		{			parse_str(ado_ExplodeName($langres,$i));			if ($lng==$l)				$lang_name="<b>".label($l)."</b>";			else				$lang_name=label($l);			if ($i)				echo " | <a class=k_text href=\"$PHP_SELF?node=-1&multi=1&pole=".$pole."&lng=$l\">$lang_name</a>";			else				echo "<a class=k_text href=\"$PHP_SELF?node=-1&multi=1&pole=".$pole."&lng=$l\">$lang_name</a>";		}	}	if (strlen($referer))		$node=$referer;	$params="lng=$lang&page=$page&pole=".$pole."&node=$node&TreeFollowLink=$TreeFollowLink&TreeDontShowPageNumber=$TreeDontShowPageNumber&referer=$referer";	ob_start();	include('include/clib.h');?><script language="javascript">var lang='<?echo $lang?>';  function wstaw_link(tx,title)   {      <?      if (strlen($pole)>0)      {        echo "        self.opener.document.getElementById('".$pole."').value=tx;        self.opener.saveLink(tx);        window.close();        ";      }      else       {        ?>          okno.document.getElementById('km_node').value=tx;          okno.document.getElementById('km_node_title').value=title;          <?      }    ?>  }  </script><script type="text/javascript" class="source">var parent=0,nd='<?echo $node?>',oldtitle='';jQueryKam(function () { 	jQueryKam("#async_json_1").tree({    data : { 			type : "json",			async : true,			contenttype : "application/json; charset=iso-8859-2",			opts : {			  method : "GET",				url : "explorer-main.php?lng="+lang+"&TreeFollowLink=<?=$TreeFollowLink?>&pole=<?=$pole?>&referer=<?=$referer?>&path=<?=$CONST_SKINS_DIR.'/'.$kameleon->user[skin]?>/jstree"			}		},		selected : lang+"_"+nd,		ui : {      theme_path : "<?=$CONST_SKINS_DIR.'/'.$kameleon->user[skin]?>/jstree/style.css"    },    types : {    	"default" : {    		clickable	: true,    		renameable	: false,    		deletable	: false,    		creatable	: true,    		draggable	: false,    		max_children	: -1,    		max_depth	: -1,    		valid_children	: "all",        		icon : {    			image : false,    			position : false    		}    	}    },		callback : {		  beforedata : function(NODE, TREE_OBJ) {        d=jQueryKam(NODE).attr("id");		    if (d==null) d=-1;        return { parent : d ,  node : <?=$node?> }      },      ondata : function(DATA, TREE_OBJ) { return DATA; },      onparse : function(STR, TREE_OBJ) {         return STR;      }		}    <?    if ($TreeFollowLink) {    ?>		, plugins : { 			contextmenu : { 				items : {					// get rid of the remove item					remove : false,					rename : false,					create : false,										// add an item of our own					add_page : {						label	: "<? echo label("Add new page")?>", 						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'DodajStrone',jQueryKam(NODE).attr("id")); 						},						separator_before : false					},										edit_page : {             label	: "<? echo label("Edit page")?>", 						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'EdytujStrone',jQueryKam(NODE).attr("id"));						},						separator_before : false          },                    delete_page : {             label	: "<? echo label("Delete page")?>", 						icon	: "img/i_delete_n.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'UsunStrone',jQueryKam(NODE).attr("id"));						},						separator_before : false          },                    rename_page : {             label	: "<? echo label("Edit title")?>", 						icon	: "img/i_title_a.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) {							expdoit(jQueryKam(NODE).attr("id"),'ReTitle',jQueryKam(NODE).attr("id"),"",jQueryKam(NODE).attr("title"));						},						separator_before : false          },										copy_page : {             label	: "<? echo label("Copy page")?>", 						icon	: "img/i_copy_n.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'copypage',jQueryKam(NODE).attr("id"),jQueryKam(NODE).attr("sid"),jQueryKam(NODE).attr("title"));						},						separator_before : false          },                    paste_page : {             label	: "<? echo label("Paste page")?>", 						icon	: "img/i_paste_n.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'pastepage',jQueryKam(NODE).attr("id"));						},						separator_before : false          },                                        visibility_page : {             label	: "<? echo label("Page invisible")?>", 						icon	: "img/i_property_n.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'visibility',jQueryKam(NODE).attr("id"));						},						separator_before : false          },                    sitemap_page : {             label	: "<? echo label("Page invisible in sitemap")?>", 						icon	: "img/i_property_n.gif", // you can set this to a classname or a path to an icon like ./myimage.gif						visible	: function (NODE, TREE_OBJ) { 							// this action will be disabled if more than one node is selected							if(NODE.length != 1) return 0; 							return 1; 						}, 												action	: function (NODE, TREE_OBJ) { 							expdoit(jQueryKam(NODE).attr("id"),'SiteMapHideShow',jQueryKam(NODE).attr("id"));						},						separator_before : false          }							}			}		}    <? } ?>	});});function expdoit(page,action,node,sid,title){  p=page.split("_");  page=p[1];    n=node.split("_");  node=n[1];	if (page=='')	{		page=node;	}	document.zmiany.referer.value=parent;	if ((action=="UsunStrone" || action=="UsunLink" || action=="UsunTD") 		&& !confirm("<?echo label("Are you sure you want to delete");?> ?")) return;	if (action=="UsunStrone" && !confirm("<?echo label("Are you really sure you want to delete whole tree");?> ?")) return;		switch (action)	{		case "DodajStrone": 			document.zmiany.page.value=-1;				document.zmiany.page_id.value=-1;				document.zmiany.referer.value=node;			document.zmiany.action.value=action;				document.zmiany.submit();			break;		case "visibility":		case "SiteMapHideShow":			document.zmiany.page.value=page;				document.zmiany.action.value=action;						if (confirm("<?= label("Do you want to change whole tree");?> ?")) document.zmiany.alltree.value=1;			document.zmiany.submit();			break;		case "EdytujStrone":			href='strona.<?= $KAMELEON_EXT?>';			document.editpage.page.value=page;				document.editpage.setreferpage.value=page;				document.editpage.action=href;				document.editpage.submit();			break;		case "copypage":			skopiuj(sid,'page',title+' ['+page+']');			break;		case "pastepage":			document.paste.referer.value=page;			document.paste.page.value=-1;			document.paste.ref_tree.value=1;			wklej(-1,'page');			break;		case "ReTitle":			newtitle=prompt('<?echo label("Title")?>',title);			if (newtitle!=null)			{					document.zmiany.title.value=newtitle;					document.zmiany.table.value="page";					document.zmiany.page.value=page;					document.zmiany.action.value=action;					document.zmiany.submit();			}			break;		case "UsunStrone":			document.zmiany.page_id.value=page;				document.zmiany.page.value=page;				document.zmiany.action.value='UsunStroneTree';				document.zmiany.submit();			break;		default:			document.zmiany.page_id.value=page;				document.zmiany.action.value=action;				document.zmiany.submit();	}}</script><div class="demo" id="async_json_1"></div><form name="zmiany" method="post" action="<?echo $SCRIPT_NAME?>"> <input type="hidden" name="action" value=""> <input type="hidden" name="page" value="0"> <input type="hidden" name="page_id" value=""> <input type="hidden" name="title" value=""> <input type="hidden" name="table" value=""> <input type="hidden" name="alltree" value="0"> <input type="hidden" name="referer" value="<?echo $referer?>"></form><form name="editpage" method="get" action=""> <input type="hidden" name="page" value="0"> <input type="hidden" name="page_id" value=""> <input type="hidden" name="setreferpage" value=""></form><?phpob_end_flush();?>